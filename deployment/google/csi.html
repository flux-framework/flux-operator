


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../_static/favicon.ico">
    
    
      
        <title>CSI for Cloud Storage - Flux Operator</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_immaterial_theme.a60204c58f5e4ff66.min.css?v=f7c3c3dc" />
        <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d68d0989" />
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<!-- Social: Facebook / Open Graph -->
<title>Flux Operator </title>
<link rel="canonical" href="https://flux-framework.github.io/flux-operator/"/>
<meta property="og:type" content="website">

<meta property="og:url" content="https://flux-framework.github.io/flux-operator/">
<meta property="og:title" content="Flux Operator">
<meta property="og:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<meta property="og:description" content="Flux Operator ">
<meta property="og:site_name" content="Flux Operator">
<meta property="og:locale" content="en_US">

<!-- Social: Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@FluxFramework">
<meta name="twitter:title" content="Flux Framework">
<meta name="twitter:description" content="Flux Operator ">
<meta name="twitter:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">

<!-- Social: Google+ / Schema.org  -->
<meta itemprop="name" content="Flux Operator">
<meta itemprop="description" content="Flux Operator ">
<meta itemprop="image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<script type="application/ld+json">
  {"@type":"WebSite","headline":"Flux Operator","url":"https://flux-framework.github.io/flux-operator","description":"The Flux Operator creates Flux MiniClusters on Kubernetes ","name":"Flux Operator","@context":"https://schema.org"}
</script>

<style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 48
}
.sphx-glr-script-out .highlight pre {
  background-color: #def0ff !important;
}
  </style>




  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Flux Operator" class="md-header__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flux Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              CSI for Cloud Storage
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../getting_started/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Getting Started</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../tutorials/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Tutorials</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">Deployment</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about/index.html" class="md-tabs__link">
      <span class="md-ellipsis">About</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Flux Operator" class="md-nav__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Flux Operator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1">
          <span class="md-ellipsis">Getting Started</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Getting Started</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/index.html" class="md-nav__link">
        <span title="/getting_started/index.md (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/index.html" class="md-nav__link">
        <span title="/development/index.md (reference label)" class="md-ellipsis">Development</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Tutorials</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Tutorials</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/index.html" class="md-nav__link">
        <span title="/tutorials/index.md (reference label)" class="md-ellipsis">Tutorials</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">Deployment</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Deployment</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../index.html"><span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span></a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../minikube.html" class="md-nav__link">
        <span title="/deployment/minikube.md (reference label)" class="md-ellipsis">Mini<wbr>Kube</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws.html" class="md-nav__link">
        <span title="/deployment/aws.md (reference label)" class="md-ellipsis">Amazon Web Services</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../ibm.html" class="md-nav__link">
        <span title="/deployment/ibm.md (reference label)" class="md-ellipsis">IBM Cloud</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_4" type="checkbox" id="__nav_3_1_4" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html"><span title="/deployment/google/index.rst (reference label)" class="md-ellipsis">Google Cloud</span></a>
          
            <label for="__nav_3_1_4">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Google Cloud" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_4">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google/index.rst (reference label)" class="md-ellipsis">Google Cloud</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="setup.html" class="md-nav__link">
        <span title="/deployment/google/setup.md (reference label)" class="md-ellipsis">Setup</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="basic.html" class="md-nav__link">
        <span title="/deployment/google/basic.md (reference label)" class="md-ellipsis">Lammps on Google Cloud</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="filestore.html" class="md-nav__link">
        <span title="/deployment/google/filestore.md (reference label)" class="md-ellipsis">Filestore <wbr>(NFS)</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/deployment/google/csi.md (reference label)" class="md-ellipsis">CSI for Cloud Storage</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/deployment/google/csi.md (reference label)" class="md-ellipsis">CSI for Cloud Storage</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-cluster" class="md-nav__link">
    <span title="/deployment/google/csi.md#create-cluster (reference label)" class="md-ellipsis">Create Cluster</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#get-credentials" class="md-nav__link">
    <span title="/deployment/google/csi.md#get-credentials (reference label)" class="md-ellipsis">Get Credentials</span>
  </a>
  
    <nav class="md-nav" aria-label="Get Credentials">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#deploy-operator" class="md-nav__link">
    <span title="/deployment/google/csi.md#deploy-operator (reference label)" class="md-ellipsis">Deploy Operator</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-flux-operator-namespace" class="md-nav__link">
    <span title="/deployment/google/csi.md#create-flux-operator-namespace (reference label)" class="md-ellipsis">Create Flux Operator namespace</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-csi" class="md-nav__link">
    <span title="/deployment/google/csi.md#install-the-csi (reference label)" class="md-ellipsis">Install the CSI</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#storage-class" class="md-nav__link">
    <span title="/deployment/google/csi.md#storage-class (reference label)" class="md-ellipsis">Storage Class</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#snakemake-minicluster" class="md-nav__link">
    <span title="/deployment/google/csi.md#snakemake-minicluster (reference label)" class="md-ellipsis">Snakemake Mini<wbr>Cluster</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span title="/deployment/google/csi.md#clean-up (reference label)" class="md-ellipsis">Clean up</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="fusion.html" class="md-nav__link">
        <span title="/deployment/google/fusion.md (reference label)" class="md-ellipsis">Fusion Storage</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4">
          <span class="md-ellipsis">About</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">About</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/index.html" class="md-nav__link">
        <span title="/about/index.md (reference label)" class="md-ellipsis">About the Flux Operator</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/flux-framework/flux-operator/blob/main/docs/deployment/google/csi.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="csi-for-cloud-storage">CSI for Cloud Storage<a class="headerlink" href="#csi-for-cloud-storage" title="Link to this heading">¶</a></h1>
<p><strong><a class="reference external" href="https://github.com/flux-framework/flux-operator/blob/main/examples/storage/google/gcs-csi/minicluster.yaml">MiniCluster YAML</a></strong></p>
<p>This basic tutorial will walk through creating a MiniCluster to run a Snakemake workflow!
We will use a “Container Storage Interface” (CSI) to connect to Snakemake assets in Google Cloud Storage.
You should have already <a class="reference internal" href="setup.html"><span class="std std-doc">setup your workspace</span></a>, including preparing the Snakemake data in
Google Storage.</p>
<h2 id="create-cluster">Create Cluster<a class="headerlink" href="#create-cluster" title="Link to this heading">¶</a></h2>
<p>Let’s use gcloud to create a cluster, and we are purposefully going to choose
a very small node type to test. Note that I choose us-central1-a because it tends
to be cheaper (and closer to me). First, here is our project for easy access:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="nv">GOOGLE_PROJECT</span><span class="o">=</span>myproject
</code></pre></div>
</div>
<p>Then create your cluster as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-cluster<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--machine-type<span class="w"> </span>n1-standard-1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility
</code></pre></div>
</div>
<p>As an example to use <code class="docutils literal notranslate"><span class="pre">core-dns</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-operator<span class="w"> </span>--cluster-dns<span class="o">=</span>clouddns<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-dns-scope<span class="o">=</span>cluster<span class="w"> </span>--region<span class="o">=</span>us-central1-a<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--machine-type<span class="w"> </span>n1-standard-2<span class="w"> </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility
</code></pre></div>
</div>
<p>If you need a particular Kubernetes version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-cluster<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--cluster-version<span class="w"> </span><span class="m">1</span>.23<span class="w"> </span>--machine-type<span class="w"> </span>n1-standard-1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility
</code></pre></div>
</div>
<p>Note that not all of the flags above might be necessary - I did a lot of testing to get
this working and didn’t go back and try removing things after the fact!
If you want to use cloud dns instead (after <a class="reference external" href="https://console.cloud.google.com/apis/library/dns.googleapis.com">enabling it</a>)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>beta<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-cluster<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--cluster-version<span class="w"> </span><span class="m">1</span>.23<span class="w"> </span>--machine-type<span class="w"> </span>n1-standard-1<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-dns<span class="o">=</span>clouddns<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--cluster-dns-scope<span class="o">=</span>cluster
</code></pre></div>
</div>
<p>In your Google cloud interface, you should be able to see the cluster! Note
this might take a few minutes.</p>
<p><img alt="img/cluster.png" src="deployment/img/cluster.png" /></p>
<p>I also chose a tiny size (nodes and instances) anticipating having it up longer to figure things out.</p>
<h2 id="get-credentials">Get Credentials<a class="headerlink" href="#get-credentials" title="Link to this heading">¶</a></h2>
<p>Next we need to ensure that we can issue commands to our cluster with kubectl.
To get credentials, in the view shown above, select the cluster and click “connect.”
Doing so will show you the correct statement to run to configure command-line access,
which probably looks something like this:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>get-credentials<span class="w"> </span>flux-cluster<span class="w"> </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span>
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">Fetching cluster endpoint and auth data.</span>
<span class="go">kubeconfig entry generated for flux-cluster.</span>
</code></pre></div>
</div>
<p>Finally, use <a class="reference external" href="https://cloud.google.com/iam">cloud IAM</a> to ensure you can create roles, etc.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>clusterrolebinding<span class="w"> </span>cluster-admin-binding<span class="w"> </span>--clusterrole<span class="w"> </span>cluster-admin<span class="w"> </span>--user<span class="w"> </span><span class="k">$(</span>gcloud<span class="w"> </span>config<span class="w"> </span>get-value<span class="w"> </span>core/account<span class="k">)</span>
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">clusterrolebinding.rbac.authorization.k8s.io/cluster-admin-binding created</span>
</code></pre></div>
</div>
<p>At this point you should be able to get your nodes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">NAME                                            STATUS   ROLES    AGE     VERSION</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-379m   Ready    &lt;none&gt;   3m41s   v1.23.14-gke.1800</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-3wf9   Ready    &lt;none&gt;   3m42s   v1.23.14-gke.1800</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-c174   Ready    &lt;none&gt;   3m42s   v1.23.14-gke.1800</span>
<span class="go">gke-flux-cluster-default-pool-f103d9d8-zz1q   Ready    &lt;none&gt;   3m42s   v1.23.14-gke.1800</span>
</code></pre></div>
</div>
<h3 id="deploy-operator">Deploy Operator<a class="headerlink" href="#deploy-operator" title="Link to this heading">¶</a></h3>
<p>To deploy the Flux Operator, <a class="reference external" href="https://flux-framework.org/flux-operator/getting_started/user-guide.html#production-install">choose one of the options here</a> to deploy the operator. Whether you apply a yaml file, use <a class="reference external" href="https://converged-computing.github.io/flux-cloud">flux-cloud</a> or clone the repository and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy</span></code> you will see the operator install to the <code class="docutils literal notranslate"><span class="pre">operator-system</span></code> namespace.</p>
<p>For a quick “production deploy” from development, the Makefile has a directive that will build and push a <code class="docutils literal notranslate"><span class="pre">test</span></code> tag (you’ll need to edit <code class="docutils literal notranslate"><span class="pre">DEVIMG</span></code> to be one you can push to) and then generate a
yaml file targeting that image, e.g.,</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>test-deploy
$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator-dev.yaml
</code></pre></div>
</div>
<p>or the production version:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator.yaml
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">...</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-manager-role created</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-metrics-reader created</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-proxy-role created</span>
<span class="go">rolebinding.rbac.authorization.k8s.io/operator-leader-election-rolebinding created</span>
<span class="go">clusterrolebinding.rbac.authorization.k8s.io/operator-manager-rolebinding created</span>
<span class="go">clusterrolebinding.rbac.authorization.k8s.io/operator-proxy-rolebinding created</span>
<span class="go">configmap/operator-manager-config created</span>
<span class="go">service/operator-controller-manager-metrics-service created</span>
<span class="go">deployment.apps/operator-controller-manager created</span>
</code></pre></div>
</div>
<p>Ensure the <code class="docutils literal notranslate"><span class="pre">operator-system</span></code> namespace was created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>namespace
NAME<span class="w">              </span>STATUS<span class="w">   </span>AGE
default<span class="w">           </span>Active<span class="w">   </span>6m39s
kube-node-lease<span class="w">   </span>Active<span class="w">   </span>6m42s
kube-public<span class="w">       </span>Active<span class="w">   </span>6m42s
kube-system<span class="w">       </span>Active<span class="w">   </span>6m42s
operator-system<span class="w">   </span>Active<span class="w">   </span>39s
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>namespace<span class="w"> </span>operator-system
Name:<span class="w">         </span>operator-system
Labels:<span class="w">       </span>control-plane<span class="o">=</span>controller-manager
<span class="w">              </span>kubernetes.io/metadata.name<span class="o">=</span>operator-system
Annotations:<span class="w">  </span>&lt;none&gt;
Status:<span class="w">       </span>Active

Resource<span class="w"> </span>Quotas
<span class="w">  </span>Name:<span class="w">                              </span>gke-resource-quotas
<span class="w">  </span>Resource<span class="w">                           </span>Used<span class="w">  </span>Hard
<span class="w">  </span>--------<span class="w">                           </span>---<span class="w">   </span>---
<span class="w">  </span>count/ingresses.extensions<span class="w">         </span><span class="m">0</span><span class="w">     </span><span class="m">100</span>
<span class="w">  </span>count/ingresses.networking.k8s.io<span class="w">  </span><span class="m">0</span><span class="w">     </span><span class="m">100</span>
<span class="w">  </span>count/jobs.batch<span class="w">                   </span><span class="m">0</span><span class="w">     </span>5k
<span class="w">  </span>pods<span class="w">                               </span><span class="m">1</span><span class="w">     </span><span class="m">1500</span>
<span class="w">  </span>services<span class="w">                           </span><span class="m">1</span><span class="w">     </span><span class="m">500</span>

No<span class="w"> </span>LimitRange<span class="w"> </span>resource.
</code></pre></div>
</div>
<p>And you can find the name of the operator pod as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>--all-namespaces
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">      &lt;none&gt;</span>
<span class="go">operator-system   operator-controller-manager-56b5bcf9fd-m8wg4               2/2     Running   0          73s</span>
</code></pre></div>
</div>
<h3 id="create-flux-operator-namespace">Create Flux Operator namespace<a class="headerlink" href="#create-flux-operator-namespace" title="Link to this heading">¶</a></h3>
<p>Make your namespace for the flux-operator custom resource definition (CRD), which is the yaml file above that generates the MiniCluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>flux-operator
</code></pre></div>
</div>
<p>Akin to how we created a local volume, we can do something similar, but instead of pointing the Flux Operator
to a volume on the host (e.g., in MiniKube) we are going to point it to a storage bucket with our data.
For this tutorial, we will use the <a class="reference external" href="https://github.com/ofek/csi-gcs">csi-gcs driver</a> to connect a cloud storage bucket to our cluster.</p>
<h2 id="install-the-csi">Install the CSI<a class="headerlink" href="#install-the-csi" title="Link to this heading">¶</a></h2>
<p>There are many <a class="reference external" href="https://kubernetes-csi.github.io/docs/drivers.html">drivers</a> for kubernetes, and we will use
<a class="reference external" href="https://ofek.dev/csi-gcs/getting_started/">this one</a> that requires a stateful set and daemon set to work.
Let’s install those first.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-k<span class="w"> </span><span class="s2">&quot;github.com/ofek/csi-gcs/deploy/overlays/stable?ref=v0.9.0&quot;</span>
$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>CSIDriver,daemonsets,pods<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>csi
</code></pre></div>
</div>
<p>And to debug:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>csi-gcs<span class="w"> </span>-c<span class="w"> </span>csi-gcs<span class="w"> </span>-n<span class="w"> </span>kube-system
</code></pre></div>
</div>
<p>As you are working, if the mounts seem to work but you don’t see files, keep
in mind you need to be aware of <a class="reference external" href="https://ofek.dev/csi-gcs/dynamic_provisioning/#extra-flags">implicit directories</a>.
The operator will do a <code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">-p</span></code> on the working directory (and this will show content there) but if you don’t
see content and expect to, you either need to interact in this way or set this flag as an annotation in
your <code class="docutils literal notranslate"><span class="pre">minicluster.yaml</span></code>.</p>
<h2 id="storage-class">Storage Class<a class="headerlink" href="#storage-class" title="Link to this heading">¶</a></h2>
<p>We can then create our storage class, this file is provided in <code class="docutils literal notranslate"><span class="pre">examples/storage/google/storageclass.yaml</span></code></p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">storage.k8s.io/v1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StorageClass</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csi-gcs</span>
<span class="nt">provisioner</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcs.csi.ofek.dev</span>
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/gcs-csi/storageclass.yaml
</code></pre></div>
</div>
<h2 id="snakemake-minicluster">Snakemake MiniCluster<a class="headerlink" href="#snakemake-minicluster" title="Link to this heading">¶</a></h2>
<p>The operator can now be run, telling it to use this storage class (named <code class="docutils literal notranslate"><span class="pre">csi-gcs</span></code>) - we provide
an example Minicluster to run this snakemake tutorial to test this out, and note that if you want to debug
you can change the command first to be an ls to see what data is there! Before you apply this file,
make sure that the annotations for storage match your Google project, zone, etc.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="w">  </span><span class="c1"># Make this kind of persistent volume and claim available to pods</span>
<span class="w">  </span><span class="c1"># This is a type of storage that will use Google Storage</span>
<span class="w">  </span><span class="nt">volumes</span><span class="p">:</span>
<span class="w">    </span><span class="nt">data</span><span class="p">:</span>
<span class="w">      </span><span class="nt">class</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csi-gcs</span>
<span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/tmp/data</span>
<span class="w">      </span><span class="nt">secret</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">csi-gcs-secret</span>
<span class="w">      </span><span class="nt">claimAnnotations</span><span class="p">:</span>
<span class="w">        </span><span class="nt">gcs.csi.ofek.dev/location</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-central1</span>
<span class="w">        </span><span class="nt">gcs.csi.ofek.dev/project-id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-project</span>
<span class="w">        </span><span class="nt">gcs.csi.ofek.dev/bucket</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-operator-storage</span>
</code></pre></div>
</div>
<p>Also note that we are setting the <code class="docutils literal notranslate"><span class="pre">commands:</span> <span class="pre">-&gt;</span> <span class="pre">runFluxAsRoot</span></code> to true. This isn’t ideal, but it was the
only way I could get the storage to both be seen and have permission to write there. Let’s create the job!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/gcs-csi/minicluster.yaml
</code></pre></div>
</div>
<p>Wait to see the certificate generator pod come up, complete, and the worker pods (that depend on it) will finish creation and
then come up:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>flux-operator
</code></pre></div>
</div>
<p>And I like to get the main pod and stream the output so I don’t miss it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># Stream to your terminal</span>
$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-fj6td<span class="w"> </span>-f

<span class="c1"># Stream to file</span>
$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-fj6td<span class="w"> </span>-f<span class="w"> </span>&gt;<span class="w"> </span>output.txt
</code></pre></div>
</div>
<details>
<summary>Snakemake output from Log</summary>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">flux user identifiers:</span>
<span class="go">uid=1000(flux) gid=1000(flux) groups=1000(flux)</span>

<span class="go">As Flux prefix for flux commands: sudo -E PYTHONPATH=/usr/lib/flux/python3.8:/code -E PATH=/opt/micromamba/envs/snakemake/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin -E HOME=/home/flux</span>

<span class="go">👋 Hello, I&#39;m flux-sample-0</span>
<span class="go">The main host is flux-sample-0</span>
<span class="go">The working directory is /workflow/snakemake-workflow, contents include:</span>
<span class="go">Dockerfile  README.md  Snakefile  data  environment.yaml  scripts</span>
<span class="go">End of file listing, if you see nothing above there are no files.</span>
<span class="go">flux R encode --hosts=flux-sample-[0-1]</span>

<span class="go">📦 Resources</span>
<span class="go">{&quot;version&quot;: 1, &quot;execution&quot;: {&quot;R_lite&quot;: [{&quot;rank&quot;: &quot;0-1&quot;, &quot;children&quot;: {&quot;core&quot;: &quot;0&quot;}}], &quot;starttime&quot;: 0.0, &quot;expiration&quot;: 0.0, &quot;nodelist&quot;: [&quot;flux-sample-[0-1]&quot;]}}</span>

<span class="go">🐸 Diagnostics: false</span>

<span class="go">🦊 Independent Minister of Privilege</span>
<span class="go">[exec]</span>
<span class="go">allowed-users = [ &quot;flux&quot;, &quot;root&quot; ]</span>
<span class="go">allowed-shells = [ &quot;/usr/libexec/flux/flux-shell&quot; ]</span>

<span class="go">🐸 Broker Configuration</span>
<span class="gp"># </span>Flux<span class="w"> </span>needs<span class="w"> </span>to<span class="w"> </span>know<span class="w"> </span>the<span class="w"> </span>path<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>IMP<span class="w"> </span>executable
<span class="go">[exec]</span>
<span class="go">imp = &quot;/usr/libexec/flux/flux-imp&quot;</span>

<span class="go">[access]</span>
<span class="go">allow-guest-user = true</span>
<span class="go">allow-root-owner = true</span>

<span class="gp"># </span>Point<span class="w"> </span>to<span class="w"> </span>resource<span class="w"> </span>definition<span class="w"> </span>generated<span class="w"> </span>with<span class="w"> </span>flux-R<span class="o">(</span><span class="m">1</span><span class="o">)</span>.
<span class="go">[resource]</span>
<span class="go">path = &quot;/etc/flux/system/R&quot;</span>

<span class="go">[bootstrap]</span>
<span class="go">curve_cert = &quot;/etc/curve/curve.cert&quot;</span>
<span class="go">default_port = 8050</span>
<span class="go">default_bind = &quot;tcp://eth0:%p&quot;</span>
<span class="go">default_connect = &quot;tcp://%h.flux-service.flux-operator.svc.cluster.local:%p&quot;</span>
<span class="go">hosts = [</span>
<span class="go">        { host=&quot;flux-sample-[0-1]&quot;},</span>
<span class="go">]</span>
<span class="gp">#   </span>****<span class="w">  </span>Generated<span class="w"> </span>on<span class="w"> </span><span class="m">2023</span>-02-17<span class="w"> </span><span class="m">21</span>:05:10<span class="w"> </span>by<span class="w"> </span>CZMQ<span class="w">  </span>****
<span class="gp">#   </span>ZeroMQ<span class="w"> </span>CURVE<span class="w"> </span>**Secret**<span class="w"> </span>Certificate
<span class="gp">#   </span>DO<span class="w"> </span>NOT<span class="w"> </span>PROVIDE<span class="w"> </span>THIS<span class="w"> </span>FILE<span class="w"> </span>TO<span class="w"> </span>OTHER<span class="w"> </span>USERS<span class="w"> </span>nor<span class="w"> </span>change<span class="w"> </span>its<span class="w"> </span>permissions.

<span class="go">metadata</span>
<span class="go">    name = &quot;flux-sample-cert-generator&quot;</span>
<span class="go">    hostname = &quot;flux-sample-0&quot;</span>
<span class="go">curve</span>
<span class="go">    public-key = &quot;.!?zfo10Ew)m=+J:j^zehs&amp;{Ayy#BGSV0Eets5Ne&quot;</span>
<span class="go">    secret-key = &quot;vmk%8&amp;dl7ICTfgx?*+0wgPb=@kFA&gt;djvZU-Sl[T6&quot;</span>

<span class="go">🔒️ Working directory permissions:</span>
<span class="go">total 3</span>
<span class="go">-rw-rw-r-- 1 root 63147  233 Feb 10 22:57 Dockerfile</span>
<span class="go">-rw-rw-r-- 1 root 63147  347 Feb 10 22:57 README.md</span>
<span class="go">-rw-rw-r-- 1 root 63147 1144 Feb 10 22:57 Snakefile</span>
<span class="go">drwxrwxr-x 1 root 63147    0 Feb 17 21:05 data</span>
<span class="go">-rw-rw-r-- 1 root 63147  203 Feb 10 22:57 environment.yaml</span>
<span class="go">drwxrwxr-x 1 root 63147    0 Feb 17 21:05 scripts</span>


<span class="go">✨ Curve certificate generated by helper pod</span>
<span class="gp">#   </span>****<span class="w">  </span>Generated<span class="w"> </span>on<span class="w"> </span><span class="m">2023</span>-02-17<span class="w"> </span><span class="m">21</span>:05:10<span class="w"> </span>by<span class="w"> </span>CZMQ<span class="w">  </span>****
<span class="gp">#   </span>ZeroMQ<span class="w"> </span>CURVE<span class="w"> </span>**Secret**<span class="w"> </span>Certificate
<span class="gp">#   </span>DO<span class="w"> </span>NOT<span class="w"> </span>PROVIDE<span class="w"> </span>THIS<span class="w"> </span>FILE<span class="w"> </span>TO<span class="w"> </span>OTHER<span class="w"> </span>USERS<span class="w"> </span>nor<span class="w"> </span>change<span class="w"> </span>its<span class="w"> </span>permissions.

<span class="go">metadata</span>
<span class="go">    name = &quot;flux-sample-cert-generator&quot;</span>
<span class="go">    hostname = &quot;flux-sample-0&quot;</span>
<span class="go">curve</span>
<span class="go">    public-key = &quot;.!?zfo10Ew)m=+J:j^zehs&amp;{Ayy#BGSV0Eets5Ne&quot;</span>
<span class="go">    secret-key = &quot;vmk%8&amp;dl7ICTfgx?*+0wgPb=@kFA&gt;djvZU-Sl[T6&quot;</span>
<span class="go">Extra arguments are: snakemake --cores 1 --flux</span>

<span class="go">🌀 flux start -o --config /etc/flux/config -Scron.directory=/etc/flux/system/cron.d   -Stbon.fanout=256   -Srundir=/run/flux   -Sstatedir=/var/lib/flux   -Slocal-uri=local:///run/flux/local   -Slog-stderr-level=6    -Slog-stderr-mode=local flux submit  -n 1 --quiet  --watch snakemake --cores 1 --flux</span>
<span class="go">broker.info[0]: start: none-&gt;join 10.6371ms</span>
<span class="go">broker.info[0]: parent-none: join-&gt;init 0.051043ms</span>
<span class="go">cron.info[0]: synchronizing cron tasks to event heartbeat.pulse</span>
<span class="go">job-manager.info[0]: restart: 0 jobs</span>
<span class="go">job-manager.info[0]: restart: 0 running jobs</span>
<span class="go">job-manager.info[0]: restart: checkpoint.job-manager not found</span>
<span class="go">broker.info[0]: rc1.0: running /etc/flux/rc1.d/01-sched-fluxion</span>
<span class="go">sched-fluxion-resource.warning[0]: create_reader: allowlist unsupported</span>
<span class="go">sched-fluxion-resource.info[0]: populate_resource_db: loaded resources from core&#39;s resource.acquire</span>
<span class="go">broker.info[0]: rc1.0: running /etc/flux/rc1.d/02-cron</span>
<span class="go">broker.info[0]: rc1.0: /etc/flux/rc1 Exited (rc=0) 0.9s</span>
<span class="go">broker.info[0]: rc1-success: init-&gt;quorum 0.922753s</span>
<span class="go">broker.info[0]: online: flux-sample-0 (ranks 0)</span>
<span class="go">broker.info[0]: online: flux-sample-[0-1] (ranks 0-1)</span>
<span class="go">broker.info[0]: quorum-full: quorum-&gt;run 0.427513s</span>
<span class="go">Building DAG of jobs...</span>
<span class="go">Using shell: /usr/bin/bash</span>
<span class="go">Provided cores: 1 (use --cores to define parallelism)</span>
<span class="go">Rules claiming more threads will be scaled down.</span>
<span class="go">Job stats:</span>
<span class="go">job               count    min threads    max threads</span>
<span class="go">--------------  -------  -------------  -------------</span>
<span class="go">all                   1              1              1</span>
<span class="go">bcftools_call         1              1              1</span>
<span class="go">bwa_map               2              1              1</span>
<span class="go">plot_quals            1              1              1</span>
<span class="go">samtools_index        2              1              1</span>
<span class="go">samtools_sort         2              1              1</span>
<span class="go">total                 9              1              1</span>

<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:05:22 2023]</span>
<span class="go">rule bwa_map:</span>
<span class="go">    input: data/genome.fa, data/samples/A.fastq</span>
<span class="go">    output: mapped_reads/A.bam</span>
<span class="go">    jobid: 4</span>
<span class="go">    reason: Missing output files: mapped_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:05:42 2023]</span>
<span class="go">Finished job 4.</span>
<span class="go">1 of 9 steps (11%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:05:43 2023]</span>
<span class="go">rule samtools_sort:</span>
<span class="go">    input: mapped_reads/A.bam</span>
<span class="go">    output: sorted_reads/A.bam</span>
<span class="go">    jobid: 3</span>
<span class="go">    reason: Missing output files: sorted_reads/A.bam; Input files updated by another job: mapped_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:05:52 2023]</span>
<span class="go">Finished job 3.</span>
<span class="go">2 of 9 steps (22%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:05:52 2023]</span>
<span class="go">rule bwa_map:</span>
<span class="go">    input: data/genome.fa, data/samples/B.fastq</span>
<span class="go">    output: mapped_reads/B.bam</span>
<span class="go">    jobid: 6</span>
<span class="go">    reason: Missing output files: mapped_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:02 2023]</span>
<span class="go">Finished job 6.</span>
<span class="go">3 of 9 steps (33%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:02 2023]</span>
<span class="go">rule samtools_sort:</span>
<span class="go">    input: mapped_reads/B.bam</span>
<span class="go">    output: sorted_reads/B.bam</span>
<span class="go">    jobid: 5</span>
<span class="go">    reason: Missing output files: sorted_reads/B.bam; Input files updated by another job: mapped_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:12 2023]</span>
<span class="go">Finished job 5.</span>
<span class="go">4 of 9 steps (44%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:13 2023]</span>
<span class="go">rule samtools_index:</span>
<span class="go">    input: sorted_reads/A.bam</span>
<span class="go">    output: sorted_reads/A.bam.bai</span>
<span class="go">    jobid: 7</span>
<span class="go">    reason: Missing output files: sorted_reads/A.bam.bai; Input files updated by another job: sorted_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:22 2023]</span>
<span class="go">Finished job 7.</span>
<span class="go">5 of 9 steps (56%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:22 2023]</span>
<span class="go">rule samtools_index:</span>
<span class="go">    input: sorted_reads/B.bam</span>
<span class="go">    output: sorted_reads/B.bam.bai</span>
<span class="go">    jobid: 8</span>
<span class="go">    reason: Missing output files: sorted_reads/B.bam.bai; Input files updated by another job: sorted_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:32 2023]</span>
<span class="go">Finished job 8.</span>
<span class="go">6 of 9 steps (67%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:32 2023]</span>
<span class="go">rule bcftools_call:</span>
<span class="go">    input: data/genome.fa, sorted_reads/A.bam, sorted_reads/B.bam, sorted_reads/A.bam.bai, sorted_reads/B.bam.bai</span>
<span class="go">    output: calls/all.vcf</span>
<span class="go">    jobid: 2</span>
<span class="go">    reason: Missing output files: calls/all.vcf; Input files updated by another job: sorted_reads/A.bam, sorted_reads/B.bam, sorted_reads/A.bam.bai, sorted_reads/B.bam.bai</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:06:43 2023]</span>
<span class="go">Finished job 2.</span>
<span class="go">7 of 9 steps (78%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:06:43 2023]</span>
<span class="go">rule plot_quals:</span>
<span class="go">    input: calls/all.vcf</span>
<span class="go">    output: plots/quals.svg</span>
<span class="go">    jobid: 1</span>
<span class="go">    reason: Missing output files: plots/quals.svg; Input files updated by another job: calls/all.vcf</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:07:02 2023]</span>
<span class="go">Finished job 1.</span>
<span class="go">8 of 9 steps (89%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Fri Feb 17 21:07:02 2023]</span>
<span class="go">localrule all:</span>
<span class="go">    input: plots/quals.svg</span>
<span class="go">    jobid: 0</span>
<span class="go">    reason: Input files updated by another job: plots/quals.svg</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Fri Feb 17 21:07:02 2023]</span>
<span class="go">Finished job 0.</span>
<span class="go">9 of 9 steps (100%) done</span>
<span class="go">Complete log: .snakemake/log/2023-02-17T210519.114509.snakemake.log</span>
<span class="go">broker.info[0]: rc2.0: flux submit -n 1 --quiet --watch snakemake --cores 1 --flux Exited (rc=0) 115.1s</span>
<span class="go">broker.info[0]: rc2-success: run-&gt;cleanup 1.91796m</span>
<span class="go">broker.info[0]: cleanup.0: flux queue stop --quiet --all --nocheckpoint Exited (rc=0) 0.0s</span>
<span class="go">broker.info[0]: cleanup.1: flux job cancelall --user=all --quiet -f --states RUN Exited (rc=0) 0.0s</span>
<span class="go">broker.info[0]: cleanup.2: flux queue idle --quiet Exited (rc=0) 0.0s</span>
<span class="go">broker.info[0]: cleanup-success: cleanup-&gt;shutdown 49.7479ms</span>
<span class="go">broker.info[0]: children-complete: shutdown-&gt;finalize 93.2169ms</span>
<span class="go">broker.info[0]: rc3.0: running /etc/flux/rc3.d/01-sched-fluxion</span>
<span class="go">broker.info[0]: online: flux-sample-0 (ranks 0)</span>
<span class="go">broker.info[0]: rc3.0: /etc/flux/rc3 Exited (rc=0) 0.2s</span>
<span class="go">broker.info[0]: rc3-success: finalize-&gt;goodbye 0.246792s</span>
<span class="go">broker.info[0]: goodbye: goodbye-&gt;exit 0.080512ms</span>
</code></pre></div>
</div>
</details>
<p>After it finishes the job will cleanup (unless you’ve set <code class="docutils literal notranslate"><span class="pre">cleanup:</span> <span class="pre">false</span></code>) in your minicluster.yaml. If you check
Google storage, you’ll see the output of the run (e.g., data in mapped_reads / mapped_samples /plots) and a “.snakemake”
hidden directory with logs.</p>
<p><img alt="img/snakemake-output.png" src="../../_images/snakemake-output.png" /></p>
<p>Note that when this is deployed in a larger scale or a more productions sense, you’ll want to account for
the details (e.g., resource limits) of the storage. This is basically done by (instead of applying the GitHub provided files)
editing them <a class="reference external" href="https://ofek.dev/csi-gcs/getting_started/#resource-requests-limits">via kustomize</a>. Note that I haven’t
tried this yet.</p>
<p><strong>Note</strong>: we would like to get this working without requiring running the workflow as root, but it hasn’t been figured
out yet! If you have insight, please comment on <a class="reference external" href="https://github.com/ofek/csi-gcs/issues/155">this issue</a>.</p>
<h2 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Link to this heading">¶</a></h2>
<p>Whatever tutorial you choose, don’t forget to clean up at the end!
You can optionally undeploy the operator (this is again at the root of the operator repository clone)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>undeploy
</code></pre></div>
</div>
<p>Or the file you used to deploy it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator.yaml
$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator-dev.yaml
</code></pre></div>
</div>
<p>And then to delete the cluster with gcloud:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>delete<span class="w"> </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>flux-cluster
</code></pre></div>
</div>
<p>I like to check in the cloud console to ensure that it was actually deleted.</p>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Sep 03, 2023
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="filestore.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Filestore (NFS)" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Filestore (NFS)
            </div>
          </div>
        </a>
      
      
        
        <a href="fusion.html" class="md-footer__link md-footer__link--next" aria-label="Next: Fusion Storage" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Fusion Storage
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022-2023, Flux Developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    7.2.5.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/flux-framework/flux-operator" target="_blank" rel="noopener" title="Flux Operator on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://flux-framework.org/" target="_blank" rel="noopener" title="Flux Framework" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 2.05c5.05.5 9 4.77 9 9.95 0 1.45-.32 2.83-.88 4.07l-2.62-1.53c.32-.79.5-1.64.5-2.54 0-3.53-2.61-6.43-6-6.92V2.05M12 19c2.21 0 4.17-1 5.45-2.62l2.6 1.53A9.97 9.97 0 0 1 12 22C6.47 22 2 17.5 2 12a9.99 9.99 0 0 1 9-9.95v3.03C7.61 5.57 5 8.47 5 12a7 7 0 0 0 7 7m0-13a6 6 0 0 1 6 6c0 2.97-2.16 5.44-5 5.92v-3.09c1.17-.41 2-1.52 2-2.83a3 3 0 0 0-3-3l-.55.05-1.54-2.67C10.56 6.13 11.26 6 12 6m-6 6c0-1.86.85-3.5 2.18-4.62l1.54 2.67C9.27 10.57 9 11.26 9 12c0 1.31.83 2.42 2 2.83v3.09c-2.84-.48-5-2.95-5-5.92Z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.tabs", "toc.integrate", "navigation.sections", "navigation.instant", "header.autohide", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../../_static/sphinx_immaterial_theme.1b5b7a2d5891aec19.min.js?v=14bafe8d"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>
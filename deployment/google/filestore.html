


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../_static/favicon.ico">
    
    
      
        <title>Filestore (NFS) - Flux Operator</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../../_static/sphinx_immaterial_theme.359ec555e2989f00f.min.css?v=379f618b" />
        <link rel="stylesheet" type="text/css" href="../../_static/custom.css?v=d68d0989" />
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<!-- Social: Facebook / Open Graph -->
<title>Flux Operator </title>
<link rel="canonical" href="https://flux-framework.github.io/flux-operator/"/>
<meta property="og:type" content="website">

<meta property="og:url" content="https://flux-framework.github.io/flux-operator/">
<meta property="og:title" content="Flux Operator">
<meta property="og:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<meta property="og:description" content="Flux Operator ">
<meta property="og:site_name" content="Flux Operator">
<meta property="og:locale" content="en_US">

<!-- Social: Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@FluxFramework">
<meta name="twitter:title" content="Flux Framework">
<meta name="twitter:description" content="Flux Operator ">
<meta name="twitter:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">

<!-- Social: Google+ / Schema.org  -->
<meta itemprop="name" content="Flux Operator">
<meta itemprop="description" content="Flux Operator ">
<meta itemprop="image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<script type="application/ld+json">
  {"@type":"WebSite","headline":"Flux Operator","url":"https://flux-framework.github.io/flux-operator","description":"The Flux Operator creates Flux MiniClusters on Kubernetes ","name":"Flux Operator","@context":"https://schema.org"}
</script>

<style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 48
}
.sphx-glr-script-out .highlight pre {
  background-color: #def0ff !important;
}
  </style>




  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../index.html" title="Flux Operator" class="md-header__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flux Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Filestore (NFS)
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../../getting_started/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Getting Started</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../tutorials/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Tutorials</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="../index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">Deployment</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../../about/index.html" class="md-tabs__link">
      <span class="md-ellipsis">About</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../index.html" title="Flux Operator" class="md-nav__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Flux Operator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1">
          <span class="md-ellipsis">Getting Started</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Getting Started</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../getting_started/index.html" class="md-nav__link">
        <span title="/getting_started/index.md (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../development/index.html" class="md-nav__link">
        <span title="/development/index.md (reference label)" class="md-ellipsis">Development</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Tutorials</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Tutorials</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/index.html" class="md-nav__link">
        <span title="/tutorials/index.md (reference label)" class="md-ellipsis">Tutorials</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">Deployment</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Deployment</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="../index.html"><span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span></a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../minikube.html" class="md-nav__link">
        <span title="/deployment/minikube.md (reference label)" class="md-ellipsis">Mini<wbr>Kube</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../aws.html" class="md-nav__link">
        <span title="/deployment/aws.md (reference label)" class="md-ellipsis">Amazon Web Services</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1_3" type="checkbox" id="__nav_3_1_3" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html"><span title="/deployment/google/index.rst (reference label)" class="md-ellipsis">Google Cloud</span></a>
          
            <label for="__nav_3_1_3">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Google Cloud" data-md-level="3">
        <label class="md-nav__title" for="__nav_3_1_3">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/google/index.rst (reference label)" class="md-ellipsis">Google Cloud</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="setup.html" class="md-nav__link">
        <span title="/deployment/google/setup.md (reference label)" class="md-ellipsis">Setup</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="basic.html" class="md-nav__link">
        <span title="/deployment/google/basic.md (reference label)" class="md-ellipsis">Lammps on Google Cloud</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/deployment/google/filestore.md (reference label)" class="md-ellipsis">Filestore <wbr>(NFS)</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/deployment/google/filestore.md (reference label)" class="md-ellipsis">Filestore <wbr>(NFS)</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-the-cluster" class="md-nav__link">
    <span title="/deployment/google/filestore.md#create-the-cluster (reference label)" class="md-ellipsis">Create the Cluster</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-flux-operator" class="md-nav__link">
    <span title="/deployment/google/filestore.md#install-the-flux-operator (reference label)" class="md-ellipsis">Install the Flux Operator</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#test-your-storage" class="md-nav__link">
    <span title="/deployment/google/filestore.md#test-your-storage (reference label)" class="md-ellipsis">Test your Storage</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-snakemake" class="md-nav__link">
    <span title="/deployment/google/filestore.md#run-snakemake (reference label)" class="md-ellipsis">Run Snakemake</span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span title="/deployment/google/filestore.md#clean-up (reference label)" class="md-ellipsis">Clean Up</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4">
          <span class="md-ellipsis">About</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">About</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../../about/index.html" class="md-nav__link">
        <span title="/about/index.md (reference label)" class="md-ellipsis">About the Flux Operator</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/flux-framework/flux-operator/blob/main/docs/deployment/google/filestore.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="filestore-nfs">Filestore (NFS)<a class="headerlink" href="#filestore-nfs" title="Link to this heading">¶</a></h1>
<p><strong><a class="reference external" href="https://github.com/flux-framework/flux-operator/blob/main/examples/storage/google/filestore/minicluster.yaml">MiniCluster YAML</a></strong></p>
<p>This tutorial will walk through creating a more persistent MiniCluster on Google Cloud
using Filestore. We will be following the guidance <a class="reference external" href="https://cloud.google.com/filestore/docs/csi-driver">here</a>.
First, make sure you have the Filestore and GKE (Google Kubernetes Engine) APIs enabled,
and the other introductory steps at that link. If you’ve used Google Cloud for Kubernetes and
Filestore before, you should largely be good to go.</p>
<h2 id="create-the-cluster">Create the Cluster<a class="headerlink" href="#create-the-cluster" title="Link to this heading">¶</a></h2>
<p>First, create your cluster with the Filestore CSI Driver enabled:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="nv">GOOGLE_PROJECT</span><span class="o">=</span>myproject
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>create<span class="w"> </span>flux-cluster<span class="w"> </span>--project<span class="w"> </span><span class="nv">$GOOGLE_PROJECT</span><span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>--machine-type<span class="w"> </span>n1-standard-2<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--addons<span class="o">=</span>GcpFilestoreCsiDriver<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--num-nodes<span class="o">=</span><span class="m">4</span><span class="w"> </span>--enable-network-policy<span class="w"> </span>--tags<span class="o">=</span>flux-cluster<span class="w"> </span>--enable-intra-node-visibility
</code></pre></div>
</div>
<h2 id="install-the-flux-operator">Install the Flux Operator<a class="headerlink" href="#install-the-flux-operator" title="Link to this heading">¶</a></h2>
<p>Let’s next install the operator. You can <a class="reference external" href="https://flux-framework.org/flux-operator/getting_started/user-guide.html#production-install">choose one of the options here</a>.
E.g., to deploy from the cloned repository:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator.yaml
</code></pre></div>
</div>
<p>Next, we want to create our persistent volume claim. This will use the
storage drivers installed already to our cluster (via the creation command).</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">data</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
<span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Ti</span>
<span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">standard-rwx</span>
</code></pre></div>
</div>
<p>Note that we’ve selected the storage class “standard-rwx” from <a class="reference external" href="https://cloud.google.com/filestore/docs/csi-driver#storage-class">this list</a>.
You can also see the <code class="docutils literal notranslate"><span class="pre">storageclass</span></code> available for your cluster via this command:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>storageclass
</code></pre></div>
</div>
<details>
<summary>storageclass Available on our Filestore Cluster</summary>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">NAME                        PROVISIONER                    RECLAIMPOLICY   VOLUMEBINDINGMODE      ALLOWVOLUMEEXPANSION   AGE</span>
<span class="go">enterprise-multishare-rwx   filestore.csi.storage.gke.io   Delete          WaitForFirstConsumer   true                   5m58s</span>
<span class="go">enterprise-rwx              filestore.csi.storage.gke.io   Delete          WaitForFirstConsumer   true                   5m57s</span>
<span class="go">premium-rwo                 pd.csi.storage.gke.io          Delete          WaitForFirstConsumer   true                   5m25s</span>
<span class="go">premium-rwx                 filestore.csi.storage.gke.io   Delete          WaitForFirstConsumer   true                   5m58s</span>
<span class="go">standard                    kubernetes.io/gce-pd           Delete          Immediate              true                   5m24s</span>
<span class="go">standard-rwo (default)      pd.csi.storage.gke.io          Delete          WaitForFirstConsumer   true                   5m25s</span>
<span class="go">standard-rwx                filestore.csi.storage.gke.io   Delete          WaitForFirstConsumer   true                   5m58s</span>
</code></pre></div>
</div>
</details>
<p>A Filestore storage class will <em>not</em> be the default (see above output) so this step is important to take! We
are going to create a persistent volume claim that says “Please use the <code class="docutils literal notranslate"><span class="pre">standard-rwx</span></code> storageclass from
Filestore to be available as a persistent volume claim - and I want all of it - the entire 1TB!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/filestore/pvc.yaml
</code></pre></div>
</div>
<p>And check on the status:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pvc
NAME<span class="w">   </span>STATUS<span class="w">    </span>VOLUME<span class="w">   </span>CAPACITY<span class="w">   </span>ACCESS<span class="w"> </span>MODES<span class="w">   </span>STORAGECLASS<span class="w">   </span>AGE
data<span class="w">   </span>Pending<span class="w">                                      </span>standard-rwx<span class="w">   </span>6s
</code></pre></div>
</div>
<p>It will be pending under we make a request to use it! Let’s do that by creating the MiniCluster:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/filestore/minicluster.yaml
</code></pre></div>
</div>
<p>We can now look at the pods:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">NAME                         READY   STATUS      RESTARTS   AGE</span>
<span class="go">flux-sample-0-vb59t          1/1     Running     0          3m22s</span>
<span class="go">flux-sample-1-xnf56          1/1     Running     0          3m21s</span>
<span class="go">flux-sample-2-7ws6d          1/1     Running     0          3m21s</span>
<span class="go">flux-sample-3-tw8m2          1/1     Running     0          3m21s</span>
</code></pre></div>
</div>
<p>Note that I saw this error at first:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="ne">Warning</span>  <span class="n">FailedScheduling</span>  <span class="mi">32</span><span class="n">s</span>   <span class="n">default</span><span class="o">-</span><span class="n">scheduler</span>  <span class="n">running</span> <span class="n">PreBind</span> <span class="n">plugin</span> <span class="s2">&quot;VolumeBinding&quot;</span><span class="p">:</span> <span class="n">Operation</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">fulfilled</span> <span class="n">on</span> <span class="n">persistentvolumeclaims</span> <span class="s2">&quot;data&quot;</span><span class="p">:</span> <span class="n">the</span> <span class="nb">object</span> <span class="n">has</span> <span class="n">been</span> <span class="n">modified</span><span class="p">;</span> <span class="n">please</span> <span class="n">apply</span> <span class="n">your</span> <span class="n">changes</span> <span class="n">to</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">version</span> <span class="ow">and</span> <span class="k">try</span> <span class="n">again</span>
</code></pre></div>
</div>
<p>I tried applying it again (and actually just waited) and then it worked - I don’t think I actually did anything. I would
give it a few minutes to (hopefully) resolve as it did for me!</p>
<h2 id="test-your-storage">Test your Storage<a class="headerlink" href="#test-your-storage" title="Link to this heading">¶</a></h2>
<p>Let’s shell into the broker (index 0) and play with our Filesystem!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>flux-sample-0-vb59t<span class="w"> </span>bash
</code></pre></div>
</div>
<p>Is it there? How big is it?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>df<span class="w"> </span>-a<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>/workflow
<span class="m">10</span>.247.103.226:/vol1<span class="w"> </span><span class="m">1055763456</span><span class="w">        </span><span class="m">0</span><span class="w"> </span><span class="m">1002059776</span><span class="w">   </span><span class="m">0</span>%<span class="w"> </span>/workflow
</code></pre></div>
</div>
<p>That is a LOT of space (that is overkill for this tutorial).
Let’s add a dinosaur fart there to test if we can see it from another pod.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>touch<span class="w"> </span>/workflow/dinosaur-fart
</code></pre></div>
</div>
<p>Did we make it?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>ls<span class="w"> </span>/workflow/
dinosaur-fart<span class="w">  </span>lost+found
</code></pre></div>
</div>
<p>And now exit and shell into another pod…</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>flux-sample-1-xnf56<span class="w"> </span>bash
</code></pre></div>
</div>
<p>Is the dinosaur fart there?</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>root@flux-sample-1:/code#<span class="w"> </span>ls<span class="w"> </span>/workflow/
dinosaur-fart<span class="w">  </span>lost+found
</code></pre></div>
</div>
<p>We have a dinosaur fart! I repeat - we have a dinosaur fart!! 🦖🌬️</p>
<h2 id="run-snakemake">Run Snakemake<a class="headerlink" href="#run-snakemake" title="Link to this heading">¶</a></h2>
<p>Let’s now run Snakemake! Since we haven’t properly set up permissions, we need to set up the workspace as root,
and then give ownership to the flux user. Let’s prepare snakemake data in <code class="docutils literal notranslate"><span class="pre">/workflow</span></code> and run it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/snakemake/snakemake-tutorial-data<span class="w"> </span>/workflow/snakemake-workflow
</code></pre></div>
</div>
<p>You’ll want to add the <a class="reference external" href="https://github.com/rse-ops/flux-hpc/blob/main/snakemake/atacseq/Snakefile">Snakefile</a> for your workflow
along with a <a class="reference external" href="https://github.com/rse-ops/flux-hpc/blob/main/snakemake/atacseq/scripts/plot-quals.py">plotting script</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>wget<span class="w"> </span>-O<span class="w"> </span>/workflow/snakemake-workflow/Snakefile<span class="w"> </span>https://raw.githubusercontent.com/rse-ops/flux-hpc/main/snakemake/atacseq/Snakefile
mkdir<span class="w"> </span>-p<span class="w"> </span>/workflow/snakemake-workflow/scripts
wget<span class="w"> </span>-O<span class="w"> </span>/workflow/snakemake-workflow/scripts/plot-quals.py<span class="w"> </span>https://raw.githubusercontent.com/rse-ops/flux-hpc/main/snakemake/atacseq/scripts/plot-quals.py
</code></pre></div>
</div>
<p>Now let’s run it! Remember that we are in interactive mode, so the broker is already running and we need to connect to it. Let’s do that first.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="nb">source</span><span class="w"> </span>/mnt/flux/flux-view.sh
flux<span class="w"> </span>proxy<span class="w"> </span><span class="nv">$fluxsocket</span><span class="w"> </span>bash
</code></pre></div>
</div>
<p>Before snakemake, let’s run a test job. You should see some subset of nodes:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>flux<span class="w"> </span>run<span class="w"> </span>-N<span class="w"> </span><span class="m">4</span><span class="w"> </span>hostname
flux-sample-0
flux-sample-2
flux-sample-3
flux-sample-1
</code></pre></div>
</div>
<p>And that the resources are available:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>flux<span class="w"> </span>resource<span class="w"> </span>list
<span class="w">     </span>STATE<span class="w"> </span>NNODES<span class="w">   </span>NCORES<span class="w"> </span>NODELIST
<span class="w">      </span>free<span class="w">      </span><span class="m">4</span><span class="w">        </span><span class="m">4</span><span class="w"> </span>flux-sample-<span class="o">[</span><span class="m">0</span>-3<span class="o">]</span>
<span class="w"> </span>allocated<span class="w">      </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w"> </span>
<span class="w">      </span>down<span class="w">      </span><span class="m">0</span><span class="w">        </span><span class="m">0</span><span class="w"> </span>
</code></pre></div>
</div>
<p>Let’s go to the worklow directory and run Snakemake using Flux.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span><span class="nb">cd</span><span class="w"> </span>/workflow/snakemake-workflow
$<span class="w"> </span>snakemake<span class="w"> </span>--cores<span class="w"> </span><span class="m">1</span><span class="w"> </span>--exeutor<span class="w"> </span>flux<span class="w"> </span>--jobs<span class="w"> </span><span class="m">4</span>
</code></pre></div>
</div>
<details>
<summary>Snakemake Workflow Output</summary>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">Building DAG of jobs...</span>
<span class="go">Using shell: /usr/bin/bash</span>
<span class="go">Provided cores: 1 (use --cores to define parallelism)</span>
<span class="go">Rules claiming more threads will be scaled down.</span>
<span class="go">Job stats:</span>
<span class="go">job               count    min threads    max threads</span>
<span class="go">--------------  -------  -------------  -------------</span>
<span class="go">all                   1              1              1</span>
<span class="go">bcftools_call         1              1              1</span>
<span class="go">bwa_map               2              1              1</span>
<span class="go">plot_quals            1              1              1</span>
<span class="go">samtools_index        2              1              1</span>
<span class="go">samtools_sort         2              1              1</span>
<span class="go">total                 9              1              1</span>

<span class="go">Select jobs to execute...</span>

<span class="go">[Thu Apr  6 23:21:57 2023]</span>
<span class="go">rule bwa_map:</span>
<span class="go">    input: data/genome.fa, data/samples/B.fastq</span>
<span class="go">    output: mapped_reads/B.bam</span>
<span class="go">    jobid: 6</span>
<span class="go">    reason: Missing output files: mapped_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 6 has been submitted with flux jobid ƒ8oNbgfi7 (log: .snakemake/flux_logs/bwa_map/sample_B.log).</span>

<span class="go">[Thu Apr  6 23:21:57 2023]</span>
<span class="go">rule bwa_map:</span>
<span class="go">    input: data/genome.fa, data/samples/A.fastq</span>
<span class="go">    output: mapped_reads/A.bam</span>
<span class="go">    jobid: 4</span>
<span class="go">    reason: Missing output files: mapped_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 4 has been submitted with flux jobid ƒ8oRe7CF9 (log: .snakemake/flux_logs/bwa_map/sample_A.log).</span>
<span class="go">[Thu Apr  6 23:22:07 2023]</span>
<span class="go">Finished job 6.</span>
<span class="go">1 of 9 steps (11%) done</span>
<span class="go">[Thu Apr  6 23:22:07 2023]</span>
<span class="go">Finished job 4.</span>
<span class="go">2 of 9 steps (22%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Thu Apr  6 23:22:07 2023]</span>
<span class="go">rule samtools_sort:</span>
<span class="go">    input: mapped_reads/B.bam</span>
<span class="go">    output: sorted_reads/B.bam</span>
<span class="go">    jobid: 5</span>
<span class="go">    reason: Missing output files: sorted_reads/B.bam; Input files updated by another job: mapped_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 5 has been submitted with flux jobid ƒ8skKRkvs (log: .snakemake/flux_logs/samtools_sort/sample_B.log).</span>

<span class="go">[Thu Apr  6 23:22:07 2023]</span>
<span class="go">rule samtools_sort:</span>
<span class="go">    input: mapped_reads/A.bam</span>
<span class="go">    output: sorted_reads/A.bam</span>
<span class="go">    jobid: 3</span>
<span class="go">    reason: Missing output files: sorted_reads/A.bam; Input files updated by another job: mapped_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 3 has been submitted with flux jobid ƒ8snWvhAX (log: .snakemake/flux_logs/samtools_sort/sample_A.log).</span>
<span class="go">[Thu Apr  6 23:22:17 2023]</span>
<span class="go">Finished job 5.</span>
<span class="go">3 of 9 steps (33%) done</span>
<span class="go">[Thu Apr  6 23:22:17 2023]</span>
<span class="go">Finished job 3.</span>
<span class="go">4 of 9 steps (44%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Thu Apr  6 23:22:17 2023]</span>
<span class="go">rule samtools_index:</span>
<span class="go">    input: sorted_reads/A.bam</span>
<span class="go">    output: sorted_reads/A.bam.bai</span>
<span class="go">    jobid: 7</span>
<span class="go">    reason: Missing output files: sorted_reads/A.bam.bai; Input files updated by another job: sorted_reads/A.bam</span>
<span class="go">    wildcards: sample=A</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 7 has been submitted with flux jobid ƒ8x9yquZq (log: .snakemake/flux_logs/samtools_index/sample_A.log).</span>

<span class="go">[Thu Apr  6 23:22:17 2023]</span>
<span class="go">rule samtools_index:</span>
<span class="go">    input: sorted_reads/B.bam</span>
<span class="go">    output: sorted_reads/B.bam.bai</span>
<span class="go">    jobid: 8</span>
<span class="go">    reason: Missing output files: sorted_reads/B.bam.bai; Input files updated by another job: sorted_reads/B.bam</span>
<span class="go">    wildcards: sample=B</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 8 has been submitted with flux jobid ƒ8xC8NsEo (log: .snakemake/flux_logs/samtools_index/sample_B.log).</span>
<span class="go">[Thu Apr  6 23:22:27 2023]</span>
<span class="go">Finished job 7.</span>
<span class="go">5 of 9 steps (56%) done</span>
<span class="go">[Thu Apr  6 23:22:27 2023]</span>
<span class="go">Finished job 8.</span>
<span class="go">6 of 9 steps (67%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Thu Apr  6 23:22:27 2023]</span>
<span class="go">rule bcftools_call:</span>
<span class="go">    input: data/genome.fa, sorted_reads/A.bam, sorted_reads/B.bam, sorted_reads/A.bam.bai, sorted_reads/B.bam.bai</span>
<span class="go">    output: calls/all.vcf</span>
<span class="go">    jobid: 2</span>
<span class="go">    reason: Missing output files: calls/all.vcf; Input files updated by another job: sorted_reads/A.bam, sorted_reads/A.bam.bai, sorted_reads/B.bam, sorted_reads/B.bam.bai</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 2 has been submitted with flux jobid ƒ92ZZp6Mm (log: .snakemake/flux_logs/bcftools_call.log).</span>
<span class="go">[Thu Apr  6 23:22:37 2023]</span>
<span class="go">Finished job 2.</span>
<span class="go">7 of 9 steps (78%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Thu Apr  6 23:22:37 2023]</span>
<span class="go">rule plot_quals:</span>
<span class="go">    input: calls/all.vcf</span>
<span class="go">    output: plots/quals.svg</span>
<span class="go">    jobid: 1</span>
<span class="go">    reason: Missing output files: plots/quals.svg; Input files updated by another job: calls/all.vcf</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">Job 1 has been submitted with flux jobid ƒ96y5LKJf (log: .snakemake/flux_logs/plot_quals.log).</span>
<span class="go">[Thu Apr  6 23:22:47 2023]</span>
<span class="go">Finished job 1.</span>
<span class="go">8 of 9 steps (89%) done</span>
<span class="go">Select jobs to execute...</span>

<span class="go">[Thu Apr  6 23:22:47 2023]</span>
<span class="go">localrule all:</span>
<span class="go">    input: plots/quals.svg</span>
<span class="go">    jobid: 0</span>
<span class="go">    reason: Input files updated by another job: plots/quals.svg</span>
<span class="go">    resources: tmpdir=/tmp</span>

<span class="go">[Thu Apr  6 23:22:47 2023]</span>
<span class="go">Finished job 0.</span>
<span class="go">9 of 9 steps (100%) done</span>
<span class="go">Complete log: .snakemake/log/2023-04-06T232156.920090.snakemake.log</span>
</code></pre></div>
</div>
</details>
<p>Wow it runs really fast with 4 jobs! When you finish, you should see all of the output files you’d expect:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>flux@flux-sample-1:/workflow/snakemake-workflow$<span class="w"> </span>tree<span class="w"> </span>.
.
├──<span class="w"> </span>Dockerfile
├──<span class="w"> </span>README.md
├──<span class="w"> </span>Snakefile
├──<span class="w"> </span>calls
│<span class="w">   </span>└──<span class="w"> </span>all.vcf
├──<span class="w"> </span>data
│<span class="w">   </span>├──<span class="w"> </span>genome.fa
│<span class="w">   </span>├──<span class="w"> </span>genome.fa.amb
│<span class="w">   </span>├──<span class="w"> </span>genome.fa.ann
│<span class="w">   </span>├──<span class="w"> </span>genome.fa.bwt
│<span class="w">   </span>├──<span class="w"> </span>genome.fa.fai
│<span class="w">   </span>├──<span class="w"> </span>genome.fa.pac
│<span class="w">   </span>├──<span class="w"> </span>genome.fa.sa
│<span class="w">   </span>└──<span class="w"> </span>samples
│<span class="w">       </span>├──<span class="w"> </span>A.fastq
│<span class="w">       </span>├──<span class="w"> </span>B.fastq
│<span class="w">       </span>└──<span class="w"> </span>C.fastq
├──<span class="w"> </span>environment.yaml
├──<span class="w"> </span>mapped_reads
│<span class="w">   </span>├──<span class="w"> </span>A.bam
│<span class="w">   </span>└──<span class="w"> </span>B.bam
├──<span class="w"> </span>plots
│<span class="w">   </span>└──<span class="w"> </span>quals.svg
├──<span class="w"> </span>scripts
│<span class="w">   </span>└──<span class="w"> </span>plot-quals.py
└──<span class="w"> </span>sorted_reads
<span class="w">    </span>├──<span class="w"> </span>A.bam
<span class="w">    </span>├──<span class="w"> </span>A.bam.bai
<span class="w">    </span>├──<span class="w"> </span>B.bam
<span class="w">    </span>└──<span class="w"> </span>B.bam.bai

<span class="m">7</span><span class="w"> </span>directories,<span class="w"> </span><span class="m">23</span><span class="w"> </span>files
</code></pre></div>
</div>
<p>And that’s it! This is a really exciting development, because Filestore can easily provide an NFS filesystem,
meaning that we could very easily create an entire Flux Framework cluster with users and a user-respecting filesystem!
We would provide this NFS Filesystem at <code class="docutils literal notranslate"><span class="pre">/home</span></code>, and then create the user directories under it, and the only check
you’d need to do is that your container base isn’t keeping anything important there.</p>
<p>I’m pumped, yo!</p>
<h2 id="clean-up">Clean Up<a class="headerlink" href="#clean-up" title="Link to this heading">¶</a></h2>
<p>Don’t forget to clean up! Delete the MiniCluster and PVC first:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/filestore/minicluster.yaml
$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/storage/google/filestore/pvc.yaml
</code></pre></div>
</div>
<p>And then delete your Kubernetes cluster. Technically  you could probably just do this, but we might as well be proper!</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>gcloud<span class="w"> </span>container<span class="w"> </span>clusters<span class="w"> </span>delete<span class="w"> </span>--zone<span class="w"> </span>us-central1-a<span class="w"> </span>flux-cluster
</code></pre></div>
</div>
<p>The other really nice detail (seriously, amazing job Google!) is that you largely don’t have to think about setting
up the storage. The Filestore instance is created with your PVC, and it’s cleaned up too.</p>
<blockquote>
<div><p>I seriously love this - I think (costs aside, assuming someone else is paying for this beast) this is my favorite Kubernetes storage solution I’ve encountered thus far! - <a class="reference external" href="https://github.com/vsoch">Vanessasaurus</a></p>
</div></blockquote>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Mar 28, 2024
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="basic.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lammps on Google Cloud" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Lammps on Google Cloud
            </div>
          </div>
        </a>
      
      
        
        <a href="../../about/index.html" class="md-footer__link md-footer__link--next" aria-label="Next: About the Flux Operator" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              About the Flux Operator
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022-2023, Flux Developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    7.2.6.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/flux-framework/flux-operator" target="_blank" rel="noopener" title="Flux Operator on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://flux-framework.org/" target="_blank" rel="noopener" title="Flux Framework" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 2.05c5.05.5 9 4.77 9 9.95 0 1.45-.32 2.83-.88 4.07l-2.62-1.53c.32-.79.5-1.64.5-2.54 0-3.53-2.61-6.43-6-6.92V2.05M12 19c2.21 0 4.17-1 5.45-2.62l2.6 1.53A9.97 9.97 0 0 1 12 22C6.47 22 2 17.5 2 12a9.99 9.99 0 0 1 9-9.95v3.03C7.61 5.57 5 8.47 5 12a7 7 0 0 0 7 7m0-13a6 6 0 0 1 6 6c0 2.97-2.16 5.44-5 5.92v-3.09c1.17-.41 2-1.52 2-2.83a3 3 0 0 0-3-3l-.55.05-1.54-2.67C10.56 6.13 11.26 6 12 6m-6 6c0-1.86.85-3.5 2.18-4.62l1.54 2.67C9.27 10.57 9 11.26 9 12c0 1.31.83 2.42 2 2.83v3.09c-2.84-.48-5-2.95-5-5.92Z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.expand", "navigation.tabs", "toc.integrate", "navigation.sections", "navigation.instant", "header.autohide", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../../_static/sphinx_immaterial_theme.f9d9eeeb247ace16c.min.js?v=9a299579"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>
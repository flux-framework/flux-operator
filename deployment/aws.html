


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../_static/favicon.ico">
    
    
      
        <title>Amazon Web Services - Flux Operator</title>
      
    
    
      
        
        
      
      

    
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../_static/sphinx_immaterial_theme.fa3fbbd75cfdd7cef.min.css" />
        <link rel="stylesheet" type="text/css" href="../_static/custom.css" />
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    


<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />

<!-- Social: Facebook / Open Graph -->
<title>Flux Operator </title>
<link rel="canonical" href="https://flux-framework.github.io/flux-operator/"/>
<meta property="og:type" content="website">

<meta property="og:url" content="https://flux-framework.github.io/flux-operator/">
<meta property="og:title" content="Flux Operator">
<meta property="og:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<meta property="og:description" content="Flux Operator ">
<meta property="og:site_name" content="Flux Operator">
<meta property="og:locale" content="en_US">

<!-- Social: Twitter -->
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="@FluxFramework">
<meta name="twitter:title" content="Flux Framework">
<meta name="twitter:description" content="Flux Operator ">
<meta name="twitter:image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">

<!-- Social: Google+ / Schema.org  -->
<meta itemprop="name" content="Flux Operator">
<meta itemprop="description" content="Flux Operator ">
<meta itemprop="image" content="https://raw.githubusercontent.com/flux-framework/flux-operator/main/docs/images/flux-operator.png">
<script type="application/ld+json">
  {"@type":"WebSite","headline":"Flux Operator","url":"https://flux-framework.github.io/flux-operator","description":"The Flux Operator creates Flux MiniClusters on Kubernetes ","name":"Flux Operator","@context":"https://schema.org"}
</script>

<style>
.material-symbols-outlined {
  font-variation-settings:
  'FILL' 0,
  'wght' 400,
  'GRAD' 0,
  'opsz' 48
}
.sphx-glr-script-out .highlight pre {
  background-color: #def0ff !important;
}
  </style>




  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="Flux Operator" class="md-header__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Flux Operator
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Amazon Web Services
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5Z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href="../getting_started/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Getting Started</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../tutorials/index.html" class="md-tabs__link">
      <span class="md-ellipsis">Tutorials</span>
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="index.html" class="md-tabs__link md-tabs__link--active">
      <span class="md-ellipsis">Deployment</span>
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../about/index.html" class="md-tabs__link">
      <span class="md-ellipsis">About</span>
    </a>
  </li>

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="Flux Operator" class="md-nav__button md-logo" aria-label="Flux Operator" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>
    </a>
    Flux Operator
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/flux-framework/flux-operator/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Flux Operator
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_1" type="checkbox" id="__nav_1" checked>
      
      
      
        <label class="md-nav__link" for="__nav_1">
          <span class="md-ellipsis">Getting Started</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Getting Started" data-md-level="1">
        <label class="md-nav__title" for="__nav_1">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Getting Started</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/index.html" class="md-nav__link">
        <span title="/getting_started/index.md (reference label)" class="md-ellipsis">User Guide</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../development/index.html" class="md-nav__link">
        <span title="/development/index.md (reference label)" class="md-ellipsis">Development</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_2" type="checkbox" id="__nav_2" checked>
      
      
      
        <label class="md-nav__link" for="__nav_2">
          <span class="md-ellipsis">Tutorials</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Tutorials" data-md-level="1">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Tutorials</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../tutorials/index.html" class="md-nav__link">
        <span title="/tutorials/index.md (reference label)" class="md-ellipsis">Tutorials</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3">
          <span class="md-ellipsis">Deployment</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Deployment" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">Deployment</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3_1" type="checkbox" id="__nav_3_1" checked>
      
      
      
        
        <div class="md-nav__link md-nav__link--index ">
          <a href="index.html"><span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span></a>
          
            <label for="__nav_3_1">
              <span class="md-nav__icon md-icon"></span>
            </label>
          
        </div>
      
      <nav class="md-nav" aria-label="Clouds" data-md-level="2">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          <span title="/deployment/index.md (reference label)" class="md-ellipsis">Clouds</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="minikube.html" class="md-nav__link">
        <span title="/deployment/minikube.md (reference label)" class="md-ellipsis">Mini<wbr>Kube</span>
      </a>
    </li>
  

            
          
            
              
  
  
    
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          <span title="/deployment/aws.md (reference label)" class="md-ellipsis">Amazon Web Services</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        <span title="/deployment/aws.md (reference label)" class="md-ellipsis">Amazon Web Services</span>
      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#setup" class="md-nav__link">
    <span title="/deployment/aws.md#setup (reference label)" class="md-ellipsis">Setup</span>
  </a>
  
    <nav class="md-nav" aria-label="Setup">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#install" class="md-nav__link">
    <span title="/deployment/aws.md#install (reference label)" class="md-ellipsis">Install</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setup-ssh" class="md-nav__link">
    <span title="/deployment/aws.md#setup-ssh (reference label)" class="md-ellipsis">Setup SSH</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-cluster" class="md-nav__link">
    <span title="/deployment/aws.md#create-cluster (reference label)" class="md-ellipsis">Create Cluster</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#deploy-operator" class="md-nav__link">
    <span title="/deployment/aws.md#deploy-operator (reference label)" class="md-ellipsis">Deploy Operator</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-flux-operator-namespace" class="md-nav__link">
    <span title="/deployment/aws.md#create-the-flux-operator-namespace (reference label)" class="md-ellipsis">Create the flux-<wbr>operator namespace</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples" class="md-nav__link">
    <span title="/deployment/aws.md#examples (reference label)" class="md-ellipsis">Examples</span>
  </a>
  
    <nav class="md-nav" aria-label="Examples">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#run-lammps" class="md-nav__link">
    <span title="/deployment/aws.md#run-lammps (reference label)" class="md-ellipsis">Run LAMMPS</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#run-snakemake-with-a-shared-filesystem" class="md-nav__link">
    <span title="/deployment/aws.md#run-snakemake-with-a-shared-filesystem (reference label)" class="md-ellipsis">Run Snakemake with a Shared Filesystem</span>
  </a>
  
    <nav class="md-nav" aria-label="Run Snakemake with a Shared Filesystem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prepare-s3-storage" class="md-nav__link">
    <span title="/deployment/aws.md#prepare-s3-storage (reference label)" class="md-ellipsis">Prepare S3 Storage</span>
  </a>
  
    <nav class="md-nav" aria-label="Prepare S3 Storage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#s3-storage-policy" class="md-nav__link">
    <span title="/deployment/aws.md#s3-storage-policy (reference label)" class="md-ellipsis">S3 Storage Policy</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-oidc-provider-for-eks" class="md-nav__link">
    <span title="/deployment/aws.md#prepare-the-oidc-provider-for-eks (reference label)" class="md-ellipsis">Prepare the OIDC Provider for EKS</span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#install-the-s3-mounter" class="md-nav__link">
    <span title="/deployment/aws.md#install-the-s3-mounter (reference label)" class="md-ellipsis">Install the S3 mounter</span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#clean-up" class="md-nav__link">
    <span title="/deployment/aws.md#clean-up (reference label)" class="md-ellipsis">Clean up</span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="google.html" class="md-nav__link">
        <span title="/deployment/google.md (reference label)" class="md-ellipsis">Google Cloud</span>
      </a>
    </li>
  

            
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="ibm.html" class="md-nav__link">
        <span title="/deployment/ibm.md (reference label)" class="md-ellipsis">IBM Cloud</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" checked>
      
      
      
        <label class="md-nav__link" for="__nav_4">
          <span class="md-ellipsis">About</span>
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="About" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          <span class="md-ellipsis">About</span>
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
  
    <li class="md-nav__item">
      <a href="../about/index.html" class="md-nav__link">
        <span title="/about/index.md (reference label)" class="md-ellipsis">About the Flux Operator</span>
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                  


  <a href="https://github.com/flux-framework/flux-operator/blob/main/docs/deployment/aws.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4v-2m10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1 2.1 2.1Z"/></svg>
  </a>

<h1 id="amazon-web-services">Amazon Web Services<a class="headerlink" href="#amazon-web-services" title="Permalink to this heading">¬∂</a></h1>
<p>This set ofl tutorials wall walk through how to run the Flux Operator on AWS!
You can start with <a class="reference internal" href="#setup"><span class="xref myst">setup</span></a> and then move down to <a class="reference internal" href="#examples"><span class="xref myst">examples</span></a>.</p>
<h2 id="setup">Setup<a class="headerlink" href="#setup" title="Permalink to this heading">¬∂</a></h2>
<h3 id="install">Install<a class="headerlink" href="#install" title="Permalink to this heading">¬∂</a></h3>
<p>You should first <a class="reference external" href="https://github.com/weaveworks/eksctl">install eksctrl</a> and make sure you have access to an AWS cloud (e.g.,
with credentials or similar in your environment). E.g.,:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">AWS_ACCESS_KEY_ID</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxx
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SECRET_ACCESS_KEY</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
<span class="nb">export</span><span class="w"> </span><span class="nv">AWS_SESSION_TOKEN</span><span class="o">=</span>xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
</code></pre></div>
</div>
<p>The last session token may not be required depending on your setup.
We assume you also have <a class="reference external" href="https://kubernetes.io/docs/tasks/tools/">kubectl</a>.</p>
<h3 id="setup-ssh">Setup SSH<a class="headerlink" href="#setup-ssh" title="Permalink to this heading">¬∂</a></h3>
<p>This step is optional if you want to access your nodes.
You‚Äôll need an ssh key for EKS. Here is how to generate it:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>ssh-keygen
<span class="c1"># Ensure you enter the path to ~/.ssh/id_eks</span>
</code></pre></div>
</div>
<p>This is used so you can ssh (connect) to your workers!</p>
<h3 id="create-cluster">Create Cluster<a class="headerlink" href="#create-cluster" title="Permalink to this heading">¬∂</a></h3>
<p>Next, let‚Äôs create our cluster using eksctl ‚Äúeks control.‚Äù <strong>IMPORTANT</strong> you absolutely
need to choose a size that has <a class="reference external" href="https://github.com/aws/amazon-vpc-resource-controller-k8s/blob/master/pkg/aws/vpc/limits.go">IsTrunkingCompatible</a>
true. Here is an example configuration. Note that we are choosing zones that works
for our account (this might vary for you) and an instance size that is appropriate
for our workloads. Also note that we are including the path to the ssh key we just
generated.</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eksctl.io/v1alpha5</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterConfig</span>

<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-operator</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.22&quot;</span>

<span class="nt">availabilityZones</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;us-east-1a&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;us-east-1b&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;us-east-1d&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">managedNodeGroups</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workers</span>
<span class="w">    </span><span class="nt">instanceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c5.xlarge</span>
<span class="w">    </span><span class="nt">minSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">maxSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="s">&quot;fluxoperator&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
<span class="w">    </span><span class="nt">ssh</span><span class="p">:</span>
<span class="w">      </span><span class="nt">allow</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
<span class="w">      </span><span class="nt">publicKeyPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">~/.ssh/id_eks.pub</span>
</code></pre></div>
</div>
<p>If you don‚Äôt need an ssh key:</p>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">eksctl.io/v1alpha5</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterConfig</span>

<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">flux-operator</span>
<span class="w">  </span><span class="nt">region</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">us-east-1</span>
<span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.23&quot;</span>

<span class="nt">availabilityZones</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;us-east-1a&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;us-east-1b&quot;</span><span class="p p-Indicator">,</span><span class="w"> </span><span class="s">&quot;us-east-1d&quot;</span><span class="p p-Indicator">]</span>
<span class="nt">managedNodeGroups</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workers</span>
<span class="w">    </span><span class="nt">instanceType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">c5.xlarge</span>
<span class="w">    </span><span class="nt">minSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">maxSize</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">4</span>
<span class="w">    </span><span class="nt">labels</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{</span><span class="w"> </span><span class="s">&quot;fluxoperator&quot;</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="p p-Indicator">}</span>
</code></pre></div>
</div>
<p>Given the above file <code class="docutils literal notranslate"><span class="pre">eks-cluster-config.yaml</span></code> we create the cluster as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>eksctl<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>-f<span class="w"> </span>eksctl-config.yaml

<span class="c1"># use the provided</span>
$<span class="w"> </span>eksctl<span class="w"> </span>create<span class="w"> </span>cluster<span class="w"> </span>-f<span class="w"> </span>./examples/storage/aws/oidc/eksctl-config.yaml
</code></pre></div>
</div>
<p>üößÔ∏è Warning! üößÔ∏è The above takes 15-20 minutes! Go have a party! Grab an avocado! ü•ëÔ∏è
And then come back and view your nodes.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
<span class="go">NAME                             STATUS   ROLES    AGE     VERSION</span>
<span class="go">ip-192-168-28-166.ec2.internal   Ready    &lt;none&gt;   4m58s   v1.22.12-eks-be74326</span>
<span class="go">ip-192-168-4-145.ec2.internal    Ready    &lt;none&gt;   4m27s   v1.22.12-eks-be74326</span>
<span class="go">ip-192-168-49-92.ec2.internal    Ready    &lt;none&gt;   5m3s    v1.22.12-eks-be74326</span>
<span class="go">ip-192-168-79-92.ec2.internal    Ready    &lt;none&gt;   4m57s   v1.22.12-eks-be74326</span>
</code></pre></div>
</div>
<h3 id="deploy-operator">Deploy Operator<a class="headerlink" href="#deploy-operator" title="Permalink to this heading">¬∂</a></h3>
<p>To deploy the Flux Operator, <a class="reference external" href="https://flux-framework.org/flux-operator/getting_started/user-guide.html#production-install">choose one of the options here</a> to deploy the operator. Whether you apply a yaml file, use <a class="reference external" href="https://converged-computing.github.io/flux-cloud">flux-cloud</a> or clone the repository and <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">deploy</span></code>. You can also deploy a development image:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>test-deploy
$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator-dev.yaml
</code></pre></div>
</div>
<p>you will see the operator install to the <code class="docutils literal notranslate"><span class="pre">operator-system</span></code> namespace.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">...</span>
<span class="go">namespace/operator-system created</span>
<span class="go">customresourcedefinition.apiextensions.k8s.io/miniclusters.flux-framework.org unchanged</span>
<span class="go">serviceaccount/operator-controller-manager created</span>
<span class="go">role.rbac.authorization.k8s.io/operator-leader-election-role created</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-manager-role configured</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-metrics-reader unchanged</span>
<span class="go">clusterrole.rbac.authorization.k8s.io/operator-proxy-role unchanged</span>
<span class="go">rolebinding.rbac.authorization.k8s.io/operator-leader-election-rolebinding created</span>
<span class="go">clusterrolebinding.rbac.authorization.k8s.io/operator-manager-rolebinding unchanged</span>
<span class="go">clusterrolebinding.rbac.authorization.k8s.io/operator-proxy-rolebinding unchanged</span>
<span class="go">configmap/operator-manager-config created</span>
<span class="go">service/operator-controller-manager-metrics-service created</span>
<span class="go">deployment.apps/operator-controller-manager created</span>
</code></pre></div>
</div>
<p>Ensure the <code class="docutils literal notranslate"><span class="pre">operator-system</span></code> namespace was created:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>namespace
NAME<span class="w">              </span>STATUS<span class="w">   </span>AGE
default<span class="w">           </span>Active<span class="w">   </span>12m
kube-node-lease<span class="w">   </span>Active<span class="w">   </span>12m
kube-public<span class="w">       </span>Active<span class="w">   </span>12m
kube-system<span class="w">       </span>Active<span class="w">   </span>12m
operator-system<span class="w">   </span>Active<span class="w">   </span>11s
</code></pre></div>
</div>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>namespace<span class="w"> </span>operator-system
Name:<span class="w">         </span>operator-system
Labels:<span class="w">       </span>control-plane<span class="o">=</span>controller-manager
<span class="w">              </span>kubernetes.io/metadata.name<span class="o">=</span>operator-system
Annotations:<span class="w">  </span>&lt;none&gt;
Status:<span class="w">       </span>Active

No<span class="w"> </span>resource<span class="w"> </span>quota.

No<span class="w"> </span>LimitRange<span class="w"> </span>resource.
</code></pre></div>
</div>
<p>And you can find the name of the operator system pod as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>--all-namespaces
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">      &lt;none&gt;</span>
<span class="go">operator-system   operator-controller-manager-6c699b7b94-bbp5q   2/2     Running   0             80s   192.168.30.43    ip-192-168-28-166.ec2.internal   &lt;none&gt;           &lt;none&gt;</span>
</code></pre></div>
</div>
<h3 id="create-the-flux-operator-namespace">Create the flux-operator namespace<a class="headerlink" href="#create-the-flux-operator-namespace" title="Permalink to this heading">¬∂</a></h3>
<p>Make your namespace for the flux-operator custom resource definition (CRD):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>flux-operator
</code></pre></div>
</div>
<h2 id="examples">Examples<a class="headerlink" href="#examples" title="Permalink to this heading">¬∂</a></h2>
<p>After setup, choose one of the following examples to run.</p>
<h3 id="run-lammps">Run LAMMPS<a class="headerlink" href="#run-lammps" title="Permalink to this heading">¬∂</a></h3>
<p>Then apply your CRD to generate the MiniCluster (default should be size 4, the max nodes of our cluster):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>apply
<span class="c1"># OR</span>
$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config/samples/flux-framework.org_v1alpha1_minicluster.yaml
</code></pre></div>
</div>
<p>And now you can get logs for the manager:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>operator-system<span class="w"> </span>operator-controller-manager-6c699b7b94-bbp5q
</code></pre></div>
</div>
<p>You‚Äôll see ‚Äúerrors‚Äù that the ip addresses aren‚Äôt ready yet, and the operator
will reconcile until they are. You can add <code class="docutils literal notranslate"><span class="pre">-f</span></code> so the logs hang to watch:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>operator-system<span class="w"> </span>operator-controller-manager-6c699b7b94-bbp5q<span class="w"> </span>-f
</code></pre></div>
</div>
<p>Once the logs indicate they are ready, you can look at the listing of nodes and the log for
the indexed job (which choosing one pod randomly to show):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>list
kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>pods
NAME<span class="w">                  </span>READY<span class="w">   </span>STATUS<span class="w">    </span>RESTARTS<span class="w">   </span>AGE
flux-sample-0-zfmzc<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m11s
flux-sample-1-p2hh5<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m11s
flux-sample-2-zs4h6<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m11s
flux-sample-3-prtn9<span class="w">   </span><span class="m">1</span>/1<span class="w">     </span>Running<span class="w">   </span><span class="m">0</span><span class="w">          </span>2m11s
</code></pre></div>
</div>
<p>And when the containers are running, in the logs you‚Äôll see see lots of cute emojis to indicate progress, and then the
start of your server! You‚Äôll need an exposed host to see the user interface, or you can interact to submit jobs via the RESTful API.
A Python client is <a class="reference external" href="https://flux-framework.org/flux-restful-api/getting_started/user-guide.html#python">available here</a>.
To use Flux Cloud to programmatically submit jobs, <a class="reference external" href="https://converged-computing.github.io/flux-cloud/getting_started/aws.html">see the guides here</a>.</p>
<h3 id="run-snakemake-with-a-shared-filesystem">Run Snakemake with a Shared Filesystem<a class="headerlink" href="#run-snakemake-with-a-shared-filesystem" title="Permalink to this heading">¬∂</a></h3>
<p>This small tutorial will run a Snakemake workflow on AWS that requires a shared
filesystem.</p>
<h4 id="prepare-s3-storage">Prepare S3 Storage<a class="headerlink" href="#prepare-s3-storage" title="Permalink to this heading">¬∂</a></h4>
<p>Let‚Äôs first get our Snakemake pre-requisite analysis files into S3.
To start, prepare your data in a temporary directory.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>git<span class="w"> </span>clone<span class="w"> </span>--depth<span class="w"> </span><span class="m">1</span><span class="w"> </span>https://github.com/snakemake/snakemake-tutorial-data<span class="w"> </span>/tmp/workflow
</code></pre></div>
</div>
<p>You‚Äôll want to add the <a class="reference external" href="https://github.com/rse-ops/flux-hpc/blob/main/snakemake/atacseq/Snakefile">Snakefile</a> for your workflow
along with a <a class="reference external" href="https://github.com/rse-ops/flux-hpc/blob/main/snakemake/atacseq/scripts/plot-quals.py">plotting script</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>wget<span class="w"> </span>-O<span class="w"> </span>/tmp/workflow/Snakefile<span class="w"> </span>https://raw.githubusercontent.com/rse-ops/flux-hpc/main/snakemake/atacseq/Snakefile
$<span class="w"> </span>mkdir<span class="w"> </span>-p<span class="w"> </span>/tmp/workflow/scripts
$<span class="w"> </span>wget<span class="w"> </span>-O<span class="w"> </span>/tmp/workflow/scripts/plot-quals.py<span class="w"> </span>https://raw.githubusercontent.com/rse-ops/flux-hpc/main/snakemake/atacseq/scripts/plot-quals.py
</code></pre></div>
</div>
<p>You should have this structure:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>tree<span class="w"> </span>/tmp/workflow
</code></pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code>/tmp/workflow/
‚îú‚îÄ‚îÄ data
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa.amb
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa.ann
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa.bwt
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa.fai
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa.pac
‚îÇ   ‚îú‚îÄ‚îÄ genome.fa.sa
‚îÇ   ‚îî‚îÄ‚îÄ samples
‚îÇ       ‚îú‚îÄ‚îÄ A.fastq
‚îÇ       ‚îú‚îÄ‚îÄ B.fastq
‚îÇ       ‚îî‚îÄ‚îÄ C.fastq
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ environment.yaml
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ scripts
‚îÇ   ‚îî‚îÄ‚îÄ plot-quals.py
‚îî‚îÄ‚îÄ Snakefile
</code></pre></div>
</div>
<p>We can then use the <code class="docutils literal notranslate"><span class="pre">aws</span></code> command line client to make a bucket ‚Äúmb‚Äù and upload to it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>s3<span class="w"> </span>mb<span class="w"> </span>s3://flux-operator-bucket<span class="w"> </span>--region<span class="w"> </span>us-east-1
</code></pre></div>
</div>
<p>Sanity check that listing buckets shows your bucket:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>s3<span class="w"> </span>ls
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">2023-02-18 18:14:32 flux-operator-workflows</span>
<span class="go">...</span>
</code></pre></div>
</div>
<p>Now copy the entire workflow to a faux ‚Äúsubdirectory‚Äù there:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="c1"># Present working directory </span>
$<span class="w"> </span>aws<span class="w"> </span>s3<span class="w"> </span>cp<span class="w"> </span>--recursive<span class="w"> </span>.<span class="w"> </span>s3://flux-operator-bucket/snakemake-workflow<span class="w"> </span>--exclude<span class="w"> </span><span class="s2">&quot;.git*&quot;</span>
</code></pre></div>
</div>
<p>Sanity check again by listing that path in the bucket</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>s3<span class="w"> </span>ls<span class="w"> </span>s3://flux-operator-bucket/snakemake-workflow/
</code></pre></div>
</div>
<h5 id="s3-storage-policy">S3 Storage Policy<a class="headerlink" href="#s3-storage-policy" title="Permalink to this heading">¬∂</a></h5>
<p>For our testing case, we made the public and created the following Permission -&gt; Bucket policy:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">{</span>
<span class="go">  &quot;Version&quot;:&quot;2012-10-17&quot;,</span>
<span class="go">  &quot;Statement&quot;:[</span>
<span class="go">    {</span>
<span class="go">      &quot;Sid&quot;:&quot;AddPerm&quot;,</span>
<span class="go">      &quot;Effect&quot;:&quot;Allow&quot;,</span>
<span class="go">      &quot;Principal&quot;: &quot;*&quot;,</span>
<span class="go">      &quot;Action&quot;: &quot;s3:*&quot;,</span>
<span class="go">      &quot;Resource&quot;:[&quot;arn:aws:s3:::my-bucket-name/*&quot;]</span>
<span class="go">    }</span>
<span class="go">  ]</span>
<span class="go">}</span>
</code></pre></div>
</div>
<p>You should obviously create a policy that would be associated with your user or credential (IAM) account.</p>
<h4 id="prepare-the-oidc-provider-for-eks">Prepare the OIDC Provider for EKS<a class="headerlink" href="#prepare-the-oidc-provider-for-eks" title="Permalink to this heading">¬∂</a></h4>
<p>We will be following <a class="reference external" href="https://dev.to/otomato_io/mount-s3-objects-to-kubernetes-pods-12f5">this guide</a>.
First, <a class="reference external" href="https://docs.aws.amazon.com/eks/latest/userguide/enable-iam-roles-for-service-accounts.html">create an OIDC role for the cluster</a>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>eks<span class="w"> </span>describe-cluster<span class="w"> </span>--name<span class="w"> </span>flux-operator<span class="w"> </span>--query<span class="w"> </span><span class="s2">&quot;cluster.identity.oidc.issuer&quot;</span><span class="w"> </span>--output<span class="w"> </span>text
</code></pre></div>
</div>
<p>Get the identifier <code class="docutils literal notranslate"><span class="pre">EXAMPLEXXXXXXXXXXXXXXX</span></code> and check if you‚Äôve already done this. If you have, the following command will have output:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>list-open-id-connect-providers<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>EXAMPLED539D4633E53DE1B7
</code></pre></div>
</div>
<p>If there is new output, open up the following section to create the OIDC provider:</p>
<details>
<summary>Create the OIDC provider</summary>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>eksctl<span class="w"> </span>utils<span class="w"> </span>associate-iam-oidc-provider<span class="w"> </span>--cluster<span class="w"> </span>flux-operator<span class="w"> </span>--approve
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">2023-02-19 19:56:55 [‚Ñπ]  will create IAM Open ID Connect provider for cluster &quot;flux-operator&quot; in &quot;us-east-1&quot;</span>
<span class="go">2023-02-19 19:56:56 [‚úî]  created IAM Open ID Connect provider for cluster &quot;flux-operator&quot; in &quot;us-east-1&quot;</span>
</code></pre></div>
</div>
<p>Then create a <code class="docutils literal notranslate"><span class="pre">policy.json</span></code> with your bucket name (you only need to do this once). The s3* is important
so we have permissions to mount, read, write, etc.</p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><code><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;Version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;2012-10-17&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;Statement&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">        </span><span class="p">{</span>
<span class="w">            </span><span class="nt">&quot;Effect&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Allow&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Action&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;s3:*&quot;</span><span class="p">,</span>
<span class="w">            </span><span class="nt">&quot;Resource&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">[</span>
<span class="w">                </span><span class="s2">&quot;arn:aws:s3:::&lt;your-bucket-name&gt;&quot;</span>
<span class="w">            </span><span class="p">]</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div>
</div>
<p>Apply the policy (here is with the example and bucket we provide):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>create-policy<span class="w"> </span>--policy-name<span class="w"> </span>kubernetes-s3-access<span class="w"> </span>--policy-document<span class="w"> </span>file://./examples/storage/aws/oidc/policy.json
</code></pre></div>
</div>
</details>
<p>Once you have the policy, create the otomount namespace:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>otomount
</code></pre></div>
</div>
<p>And then use eksctl to create the iam service account:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>eksctl<span class="w"> </span>create<span class="w"> </span>iamserviceaccount<span class="w"> </span>--name<span class="w"> </span>s3-mounter<span class="w"> </span>--namespace<span class="w"> </span>otomount<span class="w"> </span>--cluster<span class="w"> </span>flux-operator<span class="w"> </span><span class="se">\</span>
<span class="w">    </span>--role-name<span class="w"> </span><span class="s2">&quot;eks-otomounter-role&quot;</span><span class="w"> </span>--attach-policy-arn<span class="w"> </span>arn:aws:iam::633731392008:policy/kubernetes-s3-access<span class="w"> </span>--approve
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">2023-03-01 13:32:53 [‚Ñπ]  1 iamserviceaccount (otomount/s3-mounter) was included (based on the include/exclude rules)</span>
<span class="go">2023-03-01 13:32:53 [!]  serviceaccounts that exist in Kubernetes will be excluded, use --override-existing-serviceaccounts to override</span>
<span class="go">2023-03-01 13:32:53 [‚Ñπ]  1 task: { </span>
<span class="go">    2 sequential sub-tasks: { </span>
<span class="go">        create IAM role for serviceaccount &quot;otomount/s3-mounter&quot;,</span>
<span class="go">        create serviceaccount &quot;otomount/s3-mounter&quot;,</span>
<span class="go">    } }2023-03-01 13:32:53 [‚Ñπ]  building iamserviceaccount stack &quot;eksctl-flux-operator-addon-iamserviceaccount-otomount-s3-mounter&quot;</span>
<span class="go">2023-03-01 13:32:53 [‚Ñπ]  deploying stack &quot;eksctl-flux-operator-addon-iamserviceaccount-otomount-s3-mounter&quot;</span>
<span class="go">2023-03-01 13:32:54 [‚Ñπ]  waiting for CloudFormation stack &quot;eksctl-flux-operator-addon-iamserviceaccount-otomount-s3-mounter&quot;</span>
<span class="go">2023-03-01 13:33:24 [‚Ñπ]  waiting for CloudFormation stack &quot;eksctl-flux-operator-addon-iamserviceaccount-otomount-s3-mounter&quot;</span>
<span class="go">2023-03-01 13:33:24 [‚Ñπ]  created serviceaccount &quot;otomount/s3-mounter&quot;</span>
</code></pre></div>
</div>
<p>Check to make sure it worked:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>get-role<span class="w"> </span>--role-name<span class="w"> </span>eks-otomounter-role<span class="w"> </span>--query<span class="w"> </span>Role.AssumeRolePolicyDocument
</code></pre></div>
</div>
<p>And sanity check the attached role policies:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>list-attached-role-policies<span class="w"> </span>--role-name<span class="w"> </span>eks-otomounter-role<span class="w"> </span>--query<span class="w"> </span>AttachedPolicies<span class="o">[]</span>.PolicyArn<span class="w"> </span>--output<span class="w"> </span>text
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">arn:aws:iam::633731392008:policy/kubernetes-s3-access</span>
</code></pre></div>
</div>
<p>Save that to a variable</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code><span class="nb">export</span><span class="w"> </span><span class="nv">policy_arn</span><span class="o">=</span>arn:aws:iam::633731392008:policy/kubernetes-s3-access
</code></pre></div>
</div>
<p>Look at it again, to sanity check the annotation of the arn:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>get-policy<span class="w"> </span>--policy-arn<span class="w"> </span><span class="nv">$policy_arn</span>
$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>get-policy-version<span class="w"> </span>--policy-arn<span class="w"> </span><span class="nv">$policy_arn</span><span class="w"> </span>--version-id<span class="w"> </span>v1
</code></pre></div>
</div>
<p>Finally, ensure the role shows up alongside the service account:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>describe<span class="w"> </span>serviceaccount<span class="w"> </span>s3-mounter<span class="w"> </span>-n<span class="w"> </span>otomount
</code></pre></div>
</div>
<p>Also ensure that the region your bucket is in matches the resources you are interacting with above!
At this point you have the correct service account and policy, and next need to create
a daemonset that will create the mount using that service account!</p>
<h4 id="install-the-s3-mounter">Install the S3 mounter<a class="headerlink" href="#install-the-s3-mounter" title="Permalink to this heading">¬∂</a></h4>
<p>This storage drive can be installed with <a class="reference external" href="https://otomato-gh.github.io/s3-mounter">helm</a>, but for reproducibility we will
install directly from yaml (that was generated via helm). The difference here is that we have already created
the service account. In case you need to see how we generated the original oidc.yaml:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>helm<span class="w"> </span>template<span class="w"> </span>s3-mounter<span class="w"> </span>otomount/s3-otomount<span class="w">  </span>--namespace<span class="w"> </span>otomount<span class="w"> </span>--set<span class="w"> </span><span class="nv">bucketName</span><span class="o">=</span><span class="s2">&quot;flux-operator-bucket&quot;</span><span class="w"> </span><span class="se">\</span>
<span class="w">   </span>--set<span class="w"> </span><span class="nv">iamRoleARN</span><span class="o">=</span>arn:aws:iam::633731392008:policy/kubernetes-s3-access<span class="w"> </span>--create-namespace<span class="w"> </span>&gt;<span class="w"> </span>./examples/aws/oidc/oidc.yaml
</code></pre></div>
</div>
<p>To install the mounter pods (that are going to run <code class="docutils literal notranslate"><span class="pre">goofys</span></code>), we create a daemon set that will do the work as follows:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>./examples/storage/aws/oidc/oidc.yaml
</code></pre></div>
</div>
<p>A few notes about this file:</p>
<ul class="simple">
<li><p>the mount permissions assume that root (uid/gid 0) is going to run the workflow, <code class="docutils literal notranslate"><span class="pre">runFluxAsRoot</span></code> is set to true</p></li>
<li><p>the volume needs to be mounted in the pod under <code class="docutils literal notranslate"><span class="pre">/tmp/*</span></code> otherwise you won‚Äôt be able to cleanup</p></li>
<li><p>the goofys flags are what we used, but it is not clear if all are needed.</p></li>
</ul>
<p>Check the pods are running:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>otomount<span class="w"> </span>pods
</code></pre></div>
</div>
<p>You can look at their logs to debug any issues with the mount or permissions. You should
ensure they are running with no obvious error before continuing!
Then (assuming you‚Äôve already installed the operator and created the flux-operator namespace):</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>./examples/storage/aws/oidc/minicluster.yaml
</code></pre></div>
</div>
<p>The biggest factor of whether your mount will work (with permission to read and write)
is determined by the S3 storage policy and rules. For testing, we were irresponsible
and made the bucket public, but you likely don‚Äôt want to do that. Next,
get pods - you‚Äôll see the containers creating and then running - first the cert-generator
and then the MiniCluster pods:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>pods
</code></pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><code><span class="go">NAME                         READY   STATUS              RESTARTS   AGE</span>
<span class="go">flux-sample-0-f5znt          0/1     ContainerCreating   0          100s</span>
<span class="go">flux-sample-1-th589          0/1     ContainerCreating   0          100s</span>
<span class="go">flux-sample-cert-generator   0/1     Completed           0          100s</span>
</code></pre></div>
</div>
<p>You can get the output file in the terminal (and don‚Äôt worry about saving it too much, as it will save to storage).
By default cleanup is set to False so you shouldn‚Äôt lose the pod to get the pods for it.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>kubectl<span class="w"> </span>get<span class="w"> </span>-n<span class="w"> </span>flux-operator<span class="w"> </span>flux-sample-0-f5znt
</code></pre></div>
</div>
<p>Finally, note that with snakemake, once the output file in plots, called_reads and mapped_reads exist,
if you run it a second time, snakemake will determine there isn‚Äôt anything to do.</p>
<h2 id="clean-up">Clean up<a class="headerlink" href="#clean-up" title="Permalink to this heading">¬∂</a></h2>
<p>Make sure you clean everything up!
Detach roles:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>eksctl<span class="w"> </span>delete<span class="w"> </span>iamserviceaccount<span class="w"> </span>--name<span class="w"> </span>s3-mounter<span class="w"> </span>--namespace<span class="w"> </span>otomount<span class="w"> </span>--cluster<span class="w"> </span>flux-operator
</code></pre></div>
</div>
<p>Delete the flux operator in some way:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>make<span class="w"> </span>undeploy
$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator-dev.yaml
$<span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>examples/dist/flux-operator.yaml
</code></pre></div>
</div>
<p>If you created roles, you probably want to clean these up too:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>delete-role<span class="w"> </span>--role-name<span class="w"> </span>eks-otomounter-role
$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>delete-policy<span class="w"> </span>--policy-arn<span class="w"> </span>arn:aws:iam::633731392008:policy/kubernetes-s3-access
$<span class="w"> </span>aws<span class="w"> </span>iam<span class="w"> </span>delete-open-id-connect-provider<span class="w"> </span>--open-id-connect-provider-arn<span class="w"> </span><span class="s2">&quot;arn:aws:iam::633731392008:oidc-provider/oidc.eks.us-east-1.amazonaws.com/id/xxxxxxxxxxxxxx&quot;</span>
</code></pre></div>
</div>
<p>And then delete your cluster (e.g., one of the following)</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><code>$<span class="w"> </span>eksctl<span class="w"> </span>delete<span class="w"> </span>cluster<span class="w"> </span>-f<span class="w"> </span>examples/storage/aws/oidc/eksctl-config.yaml<span class="w"> </span>--wait
$<span class="w"> </span>eksctl<span class="w"> </span>delete<span class="w"> </span>cluster<span class="w"> </span>-f<span class="w"> </span>eksctl-config.yaml<span class="w"> </span>--wait
</code></pre></div>
</div>
<p>Either way, it‚Äôs good to check the web console too to ensure you didn‚Äôt miss anything.</p>


  <hr>
<div class="md-source-file">
  <small>
    
      Last update:
      Mar 11, 2023
    
  </small>
</div>





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="minikube.html" class="md-footer__link md-footer__link--prev" aria-label="Previous: MiniKube" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              MiniKube
            </div>
          </div>
        </a>
      
      
        
        <a href="google.html" class="md-footer__link md-footer__link--next" aria-label="Next: Google Cloud" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Google Cloud
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2022-2023, Flux Developers.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    6.1.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="https://github.com/flux-framework/flux-operator" target="_blank" rel="noopener" title="Flux Operator on GitHub" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="https://flux-framework.org/" target="_blank" rel="noopener" title="Flux Framework" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 2.05c5.05.5 9 4.77 9 9.95 0 1.45-.32 2.83-.88 4.07l-2.62-1.53c.32-.79.5-1.64.5-2.54 0-3.53-2.61-6.43-6-6.92V2.05M12 19c2.21 0 4.17-1 5.45-2.62l2.6 1.53A9.97 9.97 0 0 1 12 22C6.47 22 2 17.5 2 12a9.99 9.99 0 0 1 9-9.95v3.03C7.61 5.57 5 8.47 5 12a7 7 0 0 0 7 7m0-13a6 6 0 0 1 6 6c0 2.97-2.16 5.44-5 5.92v-3.09c1.17-.41 2-1.52 2-2.83a3 3 0 0 0-3-3l-.55.05-1.54-2.67C10.56 6.13 11.26 6 12 6m-6 6c0-1.86.85-3.5 2.18-4.62l1.54 2.67C9.27 10.57 9 11.26 9 12c0 1.31.83 2.42 2 2.83v3.09c-2.84-.48-5-2.95-5-5.92Z"/></svg>
    </a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.expand", "navigation.tabs", "toc.integrate", "navigation.sections", "navigation.instant", "header.autohide", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "toc.follow", "toc.sticky", "content.tabs.link", "announce.dismiss"], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
      
        <script src="../_static/sphinx_immaterial_theme.cea6a0c1d5b0618cf.min.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
  </body>
</html>